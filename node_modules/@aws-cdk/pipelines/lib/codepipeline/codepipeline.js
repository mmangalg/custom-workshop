"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.CodePipeline = void 0;
const jsiiDeprecationWarnings = require("../../.warnings.jsii.js");
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const path = require("path");
const cb = require("@aws-cdk/aws-codebuild");
const cp = require("@aws-cdk/aws-codepipeline");
const cpa = require("@aws-cdk/aws-codepipeline-actions");
const iam = require("@aws-cdk/aws-iam");
const core_1 = require("@aws-cdk/core");
const cxapi = require("@aws-cdk/cx-api");
const constructs_1 = require("constructs");
const blueprint_1 = require("../blueprint");
const docker_credentials_1 = require("../docker-credentials");
const helpers_internal_1 = require("../helpers-internal");
const main_1 = require("../main");
const asset_singleton_role_1 = require("../private/asset-singleton-role");
const cli_version_1 = require("../private/cli-version");
const construct_internals_1 = require("../private/construct-internals");
const fs_1 = require("../private/fs");
const identifiers_1 = require("../private/identifiers");
const javascript_1 = require("../private/javascript");
const template_configuration_1 = require("../private/template-configuration");
const artifact_map_1 = require("./artifact-map");
const codebuild_step_1 = require("./codebuild-step");
const codebuild_factory_1 = require("./private/codebuild-factory");
const outputs_1 = require("./private/outputs");
/**
 * A CDK Pipeline that uses CodePipeline to deploy CDK apps
 *
 * This is a `Pipeline` with its `engine` property set to
 * `CodePipelineEngine`, and exists for nicer ergonomics for
 * users that don't need to switch out engines.
 */
class CodePipeline extends main_1.PipelineBase {
    constructor(scope, id, props) {
        var _b, _c, _d, _e;
        super(scope, id, props);
        this.props = props;
        this.artifacts = new artifact_map_1.ArtifactMap();
        /**
         * Asset roles shared for publishing
         */
        this.assetCodeBuildRoles = {};
        /**
         * Per asset type, the target role ARNs that need to be assumed
         */
        this.assetPublishingRoles = {};
        try {
            jsiiDeprecationWarnings._aws_cdk_pipelines_CodePipelineProps(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.constructor);
            }
            throw error;
        }
        this.selfMutation = (_b = props.selfMutation) !== null && _b !== void 0 ? _b : true;
        this.dockerCredentials = (_c = props.dockerCredentials) !== null && _c !== void 0 ? _c : [];
        this.singlePublisherPerAssetType = !((_d = props.publishAssetsInParallel) !== null && _d !== void 0 ? _d : true);
        this.cliVersion = (_e = props.cliVersion) !== null && _e !== void 0 ? _e : cli_version_1.preferredCliVersion();
    }
    /**
     * The CodeBuild project that performs the Synth
     *
     * Only available after the pipeline has been built.
     */
    get synthProject() {
        if (!this._synthProject) {
            throw new Error('Call pipeline.buildPipeline() before reading this property');
        }
        return this._synthProject;
    }
    /**
     * The CodePipeline pipeline that deploys the CDK app
     *
     * Only available after the pipeline has been built.
     */
    get pipeline() {
        if (!this._pipeline) {
            throw new Error('Pipeline not created yet');
        }
        return this._pipeline;
    }
    doBuildPipeline() {
        var _b;
        if (this._pipeline) {
            throw new Error('Pipeline already created');
        }
        this._myCxAsmRoot = path.resolve(construct_internals_1.assemblyBuilderOf(construct_internals_1.appOf(this)).outdir);
        if (this.props.codePipeline) {
            if (this.props.pipelineName) {
                throw new Error('Cannot set \'pipelineName\' if an existing CodePipeline is given using \'codePipeline\'');
            }
            if (this.props.crossAccountKeys !== undefined) {
                throw new Error('Cannot set \'crossAccountKeys\' if an existing CodePipeline is given using \'codePipeline\'');
            }
            this._pipeline = this.props.codePipeline;
        }
        else {
            this._pipeline = new cp.Pipeline(this, 'Pipeline', {
                pipelineName: this.props.pipelineName,
                crossAccountKeys: (_b = this.props.crossAccountKeys) !== null && _b !== void 0 ? _b : false,
                reuseCrossRegionSupportStacks: this.props.reuseCrossRegionSupportStacks,
                // This is necessary to make self-mutation work (deployments are guaranteed
                // to happen only after the builds of the latest pipeline definition).
                restartExecutionOnUpdate: true,
            });
        }
        const graphFromBp = new helpers_internal_1.PipelineGraph(this, {
            selfMutation: this.selfMutation,
            singlePublisherPerAssetType: this.singlePublisherPerAssetType,
        });
        this._cloudAssemblyFileSet = graphFromBp.cloudAssemblyFileSet;
        this.pipelineStagesAndActionsFromGraph(graphFromBp);
    }
    get myCxAsmRoot() {
        if (!this._myCxAsmRoot) {
            throw new Error('Can\'t read \'myCxAsmRoot\' if build deployment not called yet');
        }
        return this._myCxAsmRoot;
    }
    /**
     * Scope for Assets-related resources.
     *
     * Purely exists for construct tree backwards compatibility with legacy pipelines
     */
    get assetsScope() {
        return construct_internals_1.obtainScope(this, 'Assets');
    }
    pipelineStagesAndActionsFromGraph(structure) {
        var _b, _c;
        // Translate graph into Pipeline Stages and Actions
        let beforeSelfMutation = this.selfMutation;
        for (const stageNode of javascript_1.flatten(structure.graph.sortedChildren())) {
            if (!helpers_internal_1.isGraph(stageNode)) {
                throw new Error(`Top-level children must be graphs, got '${stageNode}'`);
            }
            // Group our ordered tranches into blocks of 50.
            // We can map these onto stages without exceeding the capacity of a Stage.
            const chunks = chunkTranches(50, stageNode.sortedLeaves());
            const actionsOverflowStage = chunks.length > 1;
            for (const [i, tranches] of javascript_1.enumerate(chunks)) {
                const stageName = actionsOverflowStage ? `${stageNode.id}.${i + 1}` : stageNode.id;
                const pipelineStage = this.pipeline.addStage({ stageName });
                const sharedParent = new helpers_internal_1.GraphNodeCollection(javascript_1.flatten(tranches)).commonAncestor();
                let runOrder = 1;
                for (const tranche of tranches) {
                    const runOrdersConsumed = [0];
                    for (const node of tranche) {
                        const factory = this.actionFromNode(node);
                        const nodeType = this.nodeTypeFromNode(node);
                        const name = identifiers_1.actionName(node, sharedParent);
                        const variablesNamespace = ((_b = node.data) === null || _b === void 0 ? void 0 : _b.type) === 'step'
                            ? outputs_1.namespaceStepOutputs(node.data.step, pipelineStage, name)
                            : undefined;
                        const result = factory.produceAction(pipelineStage, {
                            actionName: name,
                            runOrder,
                            artifacts: this.artifacts,
                            scope: construct_internals_1.obtainScope(this.pipeline, stageName),
                            fallbackArtifact: this._fallbackArtifact,
                            pipeline: this,
                            // If this step happens to produce a CodeBuild job, set the default options
                            codeBuildDefaults: nodeType ? this.codeBuildDefaultsFor(nodeType) : undefined,
                            beforeSelfMutation,
                            variablesNamespace,
                        });
                        if (((_c = node.data) === null || _c === void 0 ? void 0 : _c.type) === 'self-update') {
                            beforeSelfMutation = false;
                        }
                        this.postProcessNode(node, result);
                        runOrdersConsumed.push(result.runOrdersConsumed);
                    }
                    runOrder += Math.max(...runOrdersConsumed);
                }
            }
        }
    }
    /**
     * Do additional things after the action got added to the pipeline
     *
     * Some minor state manipulation of CodeBuild projects and pipeline
     * artifacts.
     */
    postProcessNode(node, result) {
        var _b, _c, _d;
        const nodeType = this.nodeTypeFromNode(node);
        if (result.project) {
            const dockerUsage = dockerUsageFromCodeBuild(nodeType !== null && nodeType !== void 0 ? nodeType : CodeBuildProjectType.STEP);
            if (dockerUsage) {
                for (const c of this.dockerCredentials) {
                    c.grantRead(result.project, dockerUsage);
                }
            }
            if (nodeType === CodeBuildProjectType.SYNTH) {
                this._synthProject = result.project;
            }
        }
        if (((_b = node.data) === null || _b === void 0 ? void 0 : _b.type) === 'step' && ((_c = node.data.step.primaryOutput) === null || _c === void 0 ? void 0 : _c.primaryOutput) && !this._fallbackArtifact) {
            this._fallbackArtifact = this.artifacts.toCodePipeline((_d = node.data.step.primaryOutput) === null || _d === void 0 ? void 0 : _d.primaryOutput);
        }
    }
    /**
     * Make an action from the given node and/or step
     */
    actionFromNode(node) {
        var _b, _c;
        switch ((_b = node.data) === null || _b === void 0 ? void 0 : _b.type) {
            // Nothing for these, they are groupings (shouldn't even have popped up here)
            case 'group':
            case 'stack-group':
            case undefined:
                throw new Error(`actionFromNode: did not expect to get group nodes: ${(_c = node.data) === null || _c === void 0 ? void 0 : _c.type}`);
            case 'self-update':
                return this.selfMutateAction();
            case 'publish-assets':
                return this.publishAssetsAction(node, node.data.assets);
            case 'prepare':
                return this.createChangeSetAction(node.data.stack);
            case 'execute':
                return this.executeChangeSetAction(node.data.stack, node.data.captureOutputs);
            case 'step':
                return this.actionFromStep(node, node.data.step);
        }
    }
    /**
     * Take a Step and turn it into a CodePipeline Action
     *
     * There are only 3 types of Steps we need to support:
     *
     * - Shell (generic)
     * - ManualApproval (generic)
     * - CodePipelineActionFactory (CodePipeline-specific)
     *
     * The rest is expressed in terms of these 3, or in terms of graph nodes
     * which are handled elsewhere.
     */
    actionFromStep(node, step) {
        const nodeType = this.nodeTypeFromNode(node);
        // CodePipeline-specific steps first -- this includes Sources
        if (isCodePipelineActionFactory(step)) {
            return step;
        }
        // Now built-in steps
        if (step instanceof blueprint_1.ShellStep || step instanceof codebuild_step_1.CodeBuildStep) {
            // The 'CdkBuildProject' will be the construct ID of the CodeBuild project, necessary for backwards compat
            let constructId = nodeType === CodeBuildProjectType.SYNTH
                ? 'CdkBuildProject'
                : step.id;
            return step instanceof codebuild_step_1.CodeBuildStep
                ? codebuild_factory_1.CodeBuildFactory.fromCodeBuildStep(constructId, step)
                : codebuild_factory_1.CodeBuildFactory.fromShellStep(constructId, step);
        }
        if (step instanceof blueprint_1.ManualApprovalStep) {
            return {
                produceAction: (stage, options) => {
                    stage.addAction(new cpa.ManualApprovalAction({
                        actionName: options.actionName,
                        runOrder: options.runOrder,
                        additionalInformation: step.comment,
                    }));
                    return { runOrdersConsumed: 1 };
                },
            };
        }
        throw new Error(`Deployment step '${step}' is not supported for CodePipeline-backed pipelines`);
    }
    createChangeSetAction(stack) {
        const changeSetName = 'PipelineChange';
        const templateArtifact = this.artifacts.toCodePipeline(this._cloudAssemblyFileSet);
        const templateConfigurationPath = this.writeTemplateConfiguration(stack);
        const region = stack.region !== core_1.Stack.of(this).region ? stack.region : undefined;
        const account = stack.account !== core_1.Stack.of(this).account ? stack.account : undefined;
        const relativeTemplatePath = path.relative(this.myCxAsmRoot, stack.absoluteTemplatePath);
        return {
            produceAction: (stage, options) => {
                stage.addAction(new cpa.CloudFormationCreateReplaceChangeSetAction({
                    actionName: options.actionName,
                    runOrder: options.runOrder,
                    changeSetName,
                    stackName: stack.stackName,
                    templatePath: templateArtifact.atPath(fs_1.toPosixPath(relativeTemplatePath)),
                    adminPermissions: true,
                    role: this.roleFromPlaceholderArn(this.pipeline, region, account, stack.assumeRoleArn),
                    deploymentRole: this.roleFromPlaceholderArn(this.pipeline, region, account, stack.executionRoleArn),
                    region: region,
                    templateConfiguration: templateConfigurationPath
                        ? templateArtifact.atPath(fs_1.toPosixPath(templateConfigurationPath))
                        : undefined,
                    cfnCapabilities: [core_1.CfnCapabilities.NAMED_IAM, core_1.CfnCapabilities.AUTO_EXPAND],
                }));
                return { runOrdersConsumed: 1 };
            },
        };
    }
    executeChangeSetAction(stack, captureOutputs) {
        const changeSetName = 'PipelineChange';
        const region = stack.region !== core_1.Stack.of(this).region ? stack.region : undefined;
        const account = stack.account !== core_1.Stack.of(this).account ? stack.account : undefined;
        return {
            produceAction: (stage, options) => {
                stage.addAction(new cpa.CloudFormationExecuteChangeSetAction({
                    actionName: options.actionName,
                    runOrder: options.runOrder,
                    changeSetName,
                    stackName: stack.stackName,
                    role: this.roleFromPlaceholderArn(this.pipeline, region, account, stack.assumeRoleArn),
                    region: region,
                    variablesNamespace: captureOutputs ? identifiers_1.stackVariableNamespace(stack) : undefined,
                }));
                return { runOrdersConsumed: 1 };
            },
        };
    }
    selfMutateAction() {
        var _b;
        const installSuffix = this.cliVersion ? `@${this.cliVersion}` : '';
        const pipelineStack = core_1.Stack.of(this.pipeline);
        const pipelineStackIdentifier = (_b = pipelineStack.node.path) !== null && _b !== void 0 ? _b : pipelineStack.stackName;
        const step = new codebuild_step_1.CodeBuildStep('SelfMutate', {
            projectName: javascript_1.maybeSuffix(this.props.pipelineName, '-selfupdate'),
            input: this._cloudAssemblyFileSet,
            installCommands: [
                `npm install -g aws-cdk${installSuffix}`,
            ],
            commands: [
                `cdk -a ${fs_1.toPosixPath(construct_internals_1.embeddedAsmPath(this.pipeline))} deploy ${pipelineStackIdentifier} --require-approval=never --verbose`,
            ],
            rolePolicyStatements: [
                // allow the self-mutating project permissions to assume the bootstrap Action role
                new iam.PolicyStatement({
                    actions: ['sts:AssumeRole'],
                    resources: [`arn:*:iam::${core_1.Stack.of(this.pipeline).account}:role/*`],
                    conditions: {
                        'ForAnyValue:StringEquals': {
                            'iam:ResourceTag/aws-cdk:bootstrap-role': ['image-publishing', 'file-publishing', 'deploy'],
                        },
                    },
                }),
                new iam.PolicyStatement({
                    actions: ['cloudformation:DescribeStacks'],
                    resources: ['*'],
                }),
                // S3 checks for the presence of the ListBucket permission
                new iam.PolicyStatement({
                    actions: ['s3:ListBucket'],
                    resources: ['*'],
                }),
            ],
        });
        // Different on purpose -- id needed for backwards compatible LogicalID
        return codebuild_factory_1.CodeBuildFactory.fromCodeBuildStep('SelfMutation', step, {
            additionalConstructLevel: false,
            scope: construct_internals_1.obtainScope(this, 'UpdatePipeline'),
        });
    }
    publishAssetsAction(node, assets) {
        var _b;
        const installSuffix = this.cliVersion ? `@${this.cliVersion}` : '';
        const commands = assets.map(asset => {
            const relativeAssetManifestPath = path.relative(this.myCxAsmRoot, asset.assetManifestPath);
            return `cdk-assets --path "${fs_1.toPosixPath(relativeAssetManifestPath)}" --verbose publish "${asset.assetSelector}"`;
        });
        const assetType = assets[0].assetType;
        if (assets.some(a => a.assetType !== assetType)) {
            throw new Error('All assets in a single publishing step must be of the same type');
        }
        const publishingRoles = this.assetPublishingRoles[assetType] = ((_b = this.assetPublishingRoles[assetType]) !== null && _b !== void 0 ? _b : new Set());
        for (const asset of assets) {
            if (asset.assetPublishingRoleArn) {
                publishingRoles.add(asset.assetPublishingRoleArn);
            }
        }
        const role = this.obtainAssetCodeBuildRole(assets[0].assetType);
        // The base commands that need to be run
        const script = new codebuild_step_1.CodeBuildStep(node.id, {
            commands,
            installCommands: [
                `npm install -g cdk-assets${installSuffix}`,
            ],
            input: this._cloudAssemblyFileSet,
            buildEnvironment: {
                privileged: assets.some(asset => asset.assetType === blueprint_1.AssetType.DOCKER_IMAGE),
            },
            role,
        });
        // Customizations that are not accessible to regular users
        return codebuild_factory_1.CodeBuildFactory.fromCodeBuildStep(node.id, script, {
            additionalConstructLevel: false,
            // If we use a single publisher, pass buildspec via file otherwise it'll
            // grow too big.
            passBuildSpecViaCloudAssembly: this.singlePublisherPerAssetType,
            scope: this.assetsScope,
        });
    }
    nodeTypeFromNode(node) {
        var _b, _c, _d, _e;
        if (((_b = node.data) === null || _b === void 0 ? void 0 : _b.type) === 'step') {
            return !!((_c = node.data) === null || _c === void 0 ? void 0 : _c.isBuildStep) ? CodeBuildProjectType.SYNTH : CodeBuildProjectType.STEP;
        }
        if (((_d = node.data) === null || _d === void 0 ? void 0 : _d.type) === 'publish-assets') {
            return CodeBuildProjectType.ASSETS;
        }
        if (((_e = node.data) === null || _e === void 0 ? void 0 : _e.type) === 'self-update') {
            return CodeBuildProjectType.SELF_MUTATE;
        }
        return undefined;
    }
    codeBuildDefaultsFor(nodeType) {
        const defaultOptions = {
            buildEnvironment: {
                buildImage: cb.LinuxBuildImage.STANDARD_5_0,
                computeType: cb.ComputeType.SMALL,
            },
        };
        const typeBasedCustomizations = {
            [CodeBuildProjectType.SYNTH]: this.props.dockerEnabledForSynth
                ? codebuild_factory_1.mergeCodeBuildOptions(this.props.synthCodeBuildDefaults, { buildEnvironment: { privileged: true } })
                : this.props.synthCodeBuildDefaults,
            [CodeBuildProjectType.ASSETS]: this.props.assetPublishingCodeBuildDefaults,
            [CodeBuildProjectType.SELF_MUTATE]: this.props.dockerEnabledForSelfMutation
                ? codebuild_factory_1.mergeCodeBuildOptions(this.props.selfMutationCodeBuildDefaults, { buildEnvironment: { privileged: true } })
                : this.props.selfMutationCodeBuildDefaults,
            [CodeBuildProjectType.STEP]: {},
        };
        const dockerUsage = dockerUsageFromCodeBuild(nodeType);
        const dockerCommands = dockerUsage !== undefined
            ? docker_credentials_1.dockerCredentialsInstallCommands(dockerUsage, this.dockerCredentials, 'both')
            : [];
        const typeBasedDockerCommands = dockerCommands.length > 0 ? {
            partialBuildSpec: cb.BuildSpec.fromObject({
                version: '0.2',
                phases: {
                    pre_build: {
                        commands: dockerCommands,
                    },
                },
            }),
        } : {};
        return codebuild_factory_1.mergeCodeBuildOptions(defaultOptions, this.props.codeBuildDefaults, typeBasedCustomizations[nodeType], typeBasedDockerCommands);
    }
    roleFromPlaceholderArn(scope, region, account, arn) {
        if (!arn) {
            return undefined;
        }
        // Use placeholder arn as construct ID.
        const id = arn;
        // https://github.com/aws/aws-cdk/issues/7255
        let existingRole = constructs_1.Node.of(scope).tryFindChild(`ImmutableRole${id}`);
        if (existingRole) {
            return existingRole;
        }
        // For when #7255 is fixed.
        existingRole = constructs_1.Node.of(scope).tryFindChild(id);
        if (existingRole) {
            return existingRole;
        }
        const arnToImport = cxapi.EnvironmentPlaceholders.replace(arn, {
            region: region !== null && region !== void 0 ? region : core_1.Aws.REGION,
            accountId: account !== null && account !== void 0 ? account : core_1.Aws.ACCOUNT_ID,
            partition: core_1.Aws.PARTITION,
        });
        return iam.Role.fromRoleArn(scope, id, arnToImport, { mutable: false, addGrantsToResources: true });
    }
    /**
     * Non-template config files for CodePipeline actions
     *
     * Currently only supports tags.
     */
    writeTemplateConfiguration(stack) {
        if (Object.keys(stack.tags).length === 0) {
            return undefined;
        }
        const absConfigPath = `${stack.absoluteTemplatePath}.config.json`;
        const relativeConfigPath = path.relative(this.myCxAsmRoot, absConfigPath);
        // Write the template configuration file (for parameters into CreateChangeSet call that
        // cannot be configured any other way). They must come from a file, and there's unfortunately
        // no better hook to write this file (`construct.onSynthesize()` would have been the prime candidate
        // but that is being deprecated--and DeployCdkStackAction isn't even a construct).
        template_configuration_1.writeTemplateConfiguration(absConfigPath, {
            Tags: javascript_1.noUndefined(stack.tags),
        });
        return relativeConfigPath;
    }
    /**
     * This role is used by both the CodePipeline build action and related CodeBuild project. Consolidating these two
     * roles into one, and re-using across all assets, saves significant size of the final synthesized output.
     * Modeled after the CodePipeline role and 'CodePipelineActionRole' roles.
     * Generates one role per asset type to separate file and Docker/image-based permissions.
     */
    obtainAssetCodeBuildRole(assetType) {
        if (this.assetCodeBuildRoles[assetType]) {
            return this.assetCodeBuildRoles[assetType];
        }
        const stack = core_1.Stack.of(this);
        const rolePrefix = assetType === blueprint_1.AssetType.DOCKER_IMAGE ? 'Docker' : 'File';
        const assetRole = new asset_singleton_role_1.AssetSingletonRole(this.assetsScope, `${rolePrefix}Role`, {
            roleName: core_1.PhysicalName.GENERATE_IF_NEEDED,
            assumedBy: new iam.CompositePrincipal(new iam.ServicePrincipal('codebuild.amazonaws.com'), new iam.AccountPrincipal(stack.account)),
        });
        // Publishing role access
        // The ARNs include raw AWS pseudo parameters (e.g., ${AWS::Partition}), which need to be substituted.
        // Lazy-evaluated so all asset publishing roles are included.
        assetRole.addToPolicy(new iam.PolicyStatement({
            actions: ['sts:AssumeRole'],
            resources: core_1.Lazy.list({ produce: () => { var _b; return Array.from((_b = this.assetPublishingRoles[assetType]) !== null && _b !== void 0 ? _b : []).map(arn => core_1.Fn.sub(arn)); } }),
        }));
        // Grant pull access for any ECR registries and secrets that exist
        if (assetType === blueprint_1.AssetType.DOCKER_IMAGE) {
            this.dockerCredentials.forEach(reg => reg.grantRead(assetRole, docker_credentials_1.DockerCredentialUsage.ASSET_PUBLISHING));
        }
        this.assetCodeBuildRoles[assetType] = assetRole;
        return assetRole;
    }
}
exports.CodePipeline = CodePipeline;
_a = JSII_RTTI_SYMBOL_1;
CodePipeline[_a] = { fqn: "@aws-cdk/pipelines.CodePipeline", version: "1.153.1" };
function dockerUsageFromCodeBuild(cbt) {
    switch (cbt) {
        case CodeBuildProjectType.ASSETS: return docker_credentials_1.DockerCredentialUsage.ASSET_PUBLISHING;
        case CodeBuildProjectType.SELF_MUTATE: return docker_credentials_1.DockerCredentialUsage.SELF_UPDATE;
        case CodeBuildProjectType.SYNTH: return docker_credentials_1.DockerCredentialUsage.SYNTH;
        case CodeBuildProjectType.STEP: return undefined;
    }
}
var CodeBuildProjectType;
(function (CodeBuildProjectType) {
    CodeBuildProjectType["SYNTH"] = "SYNTH";
    CodeBuildProjectType["ASSETS"] = "ASSETS";
    CodeBuildProjectType["SELF_MUTATE"] = "SELF_MUTATE";
    CodeBuildProjectType["STEP"] = "STEP";
})(CodeBuildProjectType || (CodeBuildProjectType = {}));
/**
 * Take a set of tranches and split them up into groups so
 * that no set of tranches has more than n items total
 */
function chunkTranches(n, xss) {
    const ret = [];
    while (xss.length > 0) {
        const tranches = [];
        let count = 0;
        while (xss.length > 0) {
            const xs = xss[0];
            const spaceRemaining = n - count;
            if (xs.length <= spaceRemaining) {
                tranches.push(xs);
                count += xs.length;
                xss.shift();
            }
            else {
                tranches.push(xs.splice(0, spaceRemaining));
                count = n;
                break;
            }
        }
        ret.push(tranches);
    }
    return ret;
}
function isCodePipelineActionFactory(x) {
    return !!x.produceAction;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZXBpcGVsaW5lLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29kZXBpcGVsaW5lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDZCQUE2QjtBQUM3Qiw2Q0FBNkM7QUFDN0MsZ0RBQWdEO0FBQ2hELHlEQUF5RDtBQUV6RCx3Q0FBd0M7QUFDeEMsd0NBQThGO0FBQzlGLHlDQUF5QztBQUN6QywyQ0FBNkM7QUFDN0MsNENBQXNJO0FBQ3RJLDhEQUFrSDtBQUNsSCwwREFBOEY7QUFDOUYsa0NBQXVDO0FBQ3ZDLDBFQUFxRTtBQUNyRSx3REFBNkQ7QUFDN0Qsd0VBQXdHO0FBQ3hHLHNDQUE0QztBQUM1Qyx3REFBNEU7QUFDNUUsc0RBQXFGO0FBQ3JGLDhFQUErRTtBQUMvRSxpREFBNkM7QUFDN0MscURBQWlEO0FBRWpELG1FQUFzRjtBQUN0RiwrQ0FBeUQ7QUEwUHpEOzs7Ozs7R0FNRztBQUNILE1BQWEsWUFBYSxTQUFRLG1CQUFZO0lBNEI1QyxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFtQixLQUF3Qjs7UUFDakYsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFEaUMsVUFBSyxHQUFMLEtBQUssQ0FBbUI7UUExQjNFLGNBQVMsR0FBRyxJQUFJLDBCQUFXLEVBQUUsQ0FBQztRQU10Qzs7V0FFRztRQUNjLHdCQUFtQixHQUE4QixFQUFFLENBQUM7UUFFckU7O1dBRUc7UUFDYyx5QkFBb0IsR0FBZ0MsRUFBRSxDQUFDOzs7Ozs7Ozs7O1FBZXRFLElBQUksQ0FBQyxZQUFZLFNBQUcsS0FBSyxDQUFDLFlBQVksbUNBQUksSUFBSSxDQUFDO1FBQy9DLElBQUksQ0FBQyxpQkFBaUIsU0FBRyxLQUFLLENBQUMsaUJBQWlCLG1DQUFJLEVBQUUsQ0FBQztRQUN2RCxJQUFJLENBQUMsMkJBQTJCLEdBQUcsQ0FBQyxPQUFDLEtBQUssQ0FBQyx1QkFBdUIsbUNBQUksSUFBSSxDQUFDLENBQUM7UUFDNUUs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LENBQUE7QUFDZixDQUFDLEVBTEksb0JBQW9CLEtBQXBCLG9CQUFvQixRQUt4QjtBQUVEOzs7R0FHRztBQUNILFNBQVMsYUFBYSxDQUFJLENBQVMsRUFBRSxHQUFVO0lBQzdDLE1BQU0sR0FBRyxHQUFZLEVBQUUsQ0FBQztJQUV4QixPQUFPLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1FBQ3JCLE1BQU0sUUFBUSxHQUFVLEVBQUUsQ0FBQztRQUMzQixJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7UUFFZCxPQUFPLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ3JCLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsQixNQUFNLGNBQWMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDO1lBQ2pDLElBQUksRUFBRSxDQUFDLE1BQU0sSUFBSSxjQUFjLEVBQUU7Z0JBQy9CLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ2xCLEtBQUssSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDO2dCQUNuQixHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7YUFDYjtpQkFBTTtnQkFDTCxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLGNBQWMsQ0FBQyxDQUFDLENBQUM7Z0JBQzVDLEtBQUssR0FBRyxDQUFDLENBQUM7Z0JBQ1YsTUFBTTthQUNQO1NBQ0Y7UUFFRCxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0tBQ3BCO0lBR0QsT0FBTyxHQUFHLENBQUM7QUFDYixDQUFDO0FBRUQsU0FBUywyQkFBMkIsQ0FBQyxDQUFNO0lBQ3pDLE9BQU8sQ0FBQyxDQUFFLENBQWdDLENBQUMsYUFBYSxDQUFDO0FBQzNELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0ICogYXMgY2IgZnJvbSAnQGF3cy1jZGsvYXdzLWNvZGVidWlsZCc7XG5pbXBvcnQgKiBhcyBjcCBmcm9tICdAYXdzLWNkay9hd3MtY29kZXBpcGVsaW5lJztcbmltcG9ydCAqIGFzIGNwYSBmcm9tICdAYXdzLWNkay9hd3MtY29kZXBpcGVsaW5lLWFjdGlvbnMnO1xuaW1wb3J0ICogYXMgZWMyIGZyb20gJ0Bhd3MtY2RrL2F3cy1lYzInO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ0Bhd3MtY2RrL2F3cy1pYW0nO1xuaW1wb3J0IHsgQXdzLCBDZm5DYXBhYmlsaXRpZXMsIER1cmF0aW9uLCBGbiwgTGF6eSwgUGh5c2ljYWxOYW1lLCBTdGFjayB9IGZyb20gJ0Bhd3MtY2RrL2NvcmUnO1xuaW1wb3J0ICogYXMgY3hhcGkgZnJvbSAnQGF3cy1jZGsvY3gtYXBpJztcbmltcG9ydCB7IENvbnN0cnVjdCwgTm9kZSB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHsgQXNzZXRUeXBlLCBGaWxlU2V0LCBJRmlsZVNldFByb2R1Y2VyLCBNYW51YWxBcHByb3ZhbFN0ZXAsIFNoZWxsU3RlcCwgU3RhY2tBc3NldCwgU3RhY2tEZXBsb3ltZW50LCBTdGVwIH0gZnJvbSAnLi4vYmx1ZXByaW50JztcbmltcG9ydCB7IERvY2tlckNyZWRlbnRpYWwsIGRvY2tlckNyZWRlbnRpYWxzSW5zdGFsbENvbW1hbmRzLCBEb2NrZXJDcmVkZW50aWFsVXNhZ2UgfSBmcm9tICcuLi9kb2NrZXItY3JlZGVudGlhbHMnO1xuaW1wb3J0IHsgR3JhcGhOb2RlQ29sbGVjdGlvbiwgaXNHcmFwaCwgQUdyYXBoTm9kZSwgUGlwZWxpbmVHcmFwaCB9IGZyb20gJy4uL2hlbHBlcnMtaW50ZXJuYWwnO1xuaW1wb3J0IHsgUGlwZWxpbmVCYXNlIH0gZnJvbSAnLi4vbWFpbic7XG5pbXBvcnQgeyBBc3NldFNpbmdsZXRvblJvbGUgfSBmcm9tICcuLi9wcml2YXRlL2Fzc2V0LXNpbmdsZXRvbi1yb2xlJztcbmltcG9ydCB7IHByZWZlcnJlZENsaVZlcnNpb24gfSBmcm9tICcuLi9wcml2YXRlL2NsaS12ZXJzaW9uJztcbmltcG9ydCB7IGFwcE9mLCBhc3NlbWJseUJ1aWxkZXJPZiwgZW1iZWRkZWRBc21QYXRoLCBvYnRhaW5TY29wZSB9IGZyb20gJy4uL3ByaXZhdGUvY29uc3RydWN0LWludGVybmFscyc7XG5pbXBvcnQgeyB0b1Bvc2l4UGF0aCB9IGZyb20gJy4uL3ByaXZhdGUvZnMnO1xuaW1wb3J0IHsgYWN0aW9uTmFtZSwgc3RhY2tWYXJpYWJsZU5hbWVzcGFjZSB9IGZyb20gJy4uL3ByaXZhdGUvaWRlbnRpZmllcnMnO1xuaW1wb3J0IHsgZW51bWVyYXRlLCBmbGF0dGVuLCBtYXliZVN1ZmZpeCwgbm9VbmRlZmluZWQgfSBmcm9tICcuLi9wcml2YXRlL2phdmFzY3JpcHQnO1xuaW1wb3J0IHsgd3JpdGVUZW1wbGF0ZUNvbmZpZ3VyYXRpb24gfSBmcm9tICcuLi9wcml2YXRlL3RlbXBsYXRlLWNvbmZpZ3VyYXRpb24nO1xuaW1wb3J0IHsgQXJ0aWZhY3RNYXAgfSBmcm9tICcuL2FydGlmYWN0LW1hcCc7XG5pbXBvcnQgeyBDb2RlQnVpbGRTdGVwIH0gZnJvbSAnLi9jb2RlYnVpbGQtc3RlcCc7XG5pbXBvcnQgeyBDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5UmVzdWx0LCBJQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSB9IGZyb20gJy4vY29kZXBpcGVsaW5lLWFjdGlvbi1mYWN0b3J5JztcbmltcG9ydCB7IENvZGVCdWlsZEZhY3RvcnksIG1lcmdlQ29kZUJ1aWxkT3B0aW9ucyB9IGZyb20gJy4vcHJpdmF0ZS9jb2RlYnVpbGQtZmFjdG9yeSc7XG5pbXBvcnQgeyBuYW1lc3BhY2VTdGVwT3V0cHV0cyB9IGZyb20gJy4vcHJpdmF0ZS9vdXRwdXRzJztcblxuXG4vKipcbiAqIFByb3BlcnRpZXMgZm9yIGEgYENvZGVQaXBlbGluZWBcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBDb2RlUGlwZWxpbmVQcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgYnVpbGQgc3RlcCB0aGF0IHByb2R1Y2VzIHRoZSBDREsgQ2xvdWQgQXNzZW1ibHlcbiAgICpcbiAgICogVGhlIHByaW1hcnkgb3V0cHV0IG9mIHRoaXMgc3RlcCBuZWVkcyB0byBiZSB0aGUgYGNkay5vdXRgIGRpcmVjdG9yeVxuICAgKiBnZW5lcmF0ZWQgYnkgdGhlIGBjZGsgc3ludGhgIGNvbW1hbmQuXG4gICAqXG4gICAqIElmIHlvdSB1c2UgYSBgU2hlbGxTdGVwYCBoZXJlIGFuZCB5b3UgZG9uJ3QgY29uZmlndXJlIGFuIG91dHB1dCBkaXJlY3RvcnksXG4gICAqIHRoZSBvdXRwdXQgZGlyZWN0b3J5IHdpbGwgYXV0b21hdGljYWxseSBiZSBhc3N1bWVkIHRvIGJlIGBjZGsub3V0YC5cbiAgICovXG4gIHJlYWRvbmx5IHN5bnRoOiBJRmlsZVNldFByb2R1Y2VyO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgQ29kZVBpcGVsaW5lIHBpcGVsaW5lXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gQXV0b21hdGljYWxseSBnZW5lcmF0ZWRcbiAgICovXG4gIHJlYWRvbmx5IHBpcGVsaW5lTmFtZT86IHN0cmluZztcblxuICAvKipcbiAgICogQ3JlYXRlIEtNUyBrZXlzIGZvciB0aGUgYXJ0aWZhY3QgYnVja2V0cywgYWxsb3dpbmcgY3Jvc3MtYWNjb3VudCBkZXBsb3ltZW50c1xuICAgKlxuICAgKiBUaGUgYXJ0aWZhY3QgYnVja2V0cyBoYXZlIHRvIGJlIGVuY3J5cHRlZCB0byBzdXBwb3J0IGRlcGxveWluZyBDREsgYXBwcyB0b1xuICAgKiBhbm90aGVyIGFjY291bnQsIHNvIGlmIHlvdSB3YW50IHRvIGRvIHRoYXQgb3Igd2FudCB0byBoYXZlIHlvdXIgYXJ0aWZhY3RcbiAgICogYnVja2V0cyBlbmNyeXB0ZWQsIGJlIHN1cmUgdG8gc2V0IHRoaXMgdmFsdWUgdG8gYHRydWVgLlxuICAgKlxuICAgKiBCZSBhd2FyZSB0aGVyZSBpcyBhIGNvc3QgYXNzb2NpYXRlZCB3aXRoIG1haW50YWluaW5nIHRoZSBLTVMga2V5cy5cbiAgICpcbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHJlYWRvbmx5IGNyb3NzQWNjb3VudEtleXM/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBDREsgQ0xJIHZlcnNpb24gdG8gdXNlIGluIHNlbGYtbXV0YXRpb24gYW5kIGFzc2V0IHB1Ymxpc2hpbmcgc3RlcHNcbiAgICpcbiAgICogSWYgeW91IHdhbnQgdG8gbG9jayB0aGUgQ0RLIENMSSB2ZXJzaW9uIHVzZWQgaW4gdGhlIHBpcGVsaW5lLCBieSBzdGVwc1xuICAgKiB0aGF0IGFyZSBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBmb3IgeW91LCBzcGVjaWZ5IHRoZSB2ZXJzaW9uIGhlcmUuXG4gICAqXG4gICAqIFdlIHJlY29tbWVuZCB5b3UgZG8gbm90IHNwZWNpZnkgdGhpcyB2YWx1ZSwgYXMgbm90IHNwZWNpZnlpbmcgaXQgYWx3YXlzXG4gICAqIHVzZXMgdGhlIGxhdGVzdCBDTEkgdmVyc2lvbiB3aGljaCBpcyBiYWNrd2FyZHMgY29tcGF0aWJsZSB3aXRoIG9sZCB2ZXJzaW9ucy5cbiAgICpcbiAgICogSWYgeW91IGRvIHNwZWNpZnkgaXQsIGJlIGF3YXJlIHRoYXQgdGhpcyB2ZXJzaW9uIHNob3VsZCBhbHdheXMgYmUgZXF1YWwgdG8gb3IgaGlnaGVyIHRoYW4gdGhlXG4gICAqIHZlcnNpb24gb2YgdGhlIENESyBmcmFtZXdvcmsgdXNlZCBieSB0aGUgQ0RLIGFwcCwgd2hlbiB0aGUgQ0RLIGNvbW1hbmRzIGFyZVxuICAgKiBydW4gZHVyaW5nIHlvdXIgcGlwZWxpbmUgZXhlY3V0aW9uLiBXaGVuIHlvdSBjaGFuZ2UgdGhpcyB2ZXJzaW9uLCB0aGUgKm5leHRcbiAgICogdGltZSogdGhlIGBTZWxmTXV0YXRlYCBzdGVwIHJ1bnMgaXQgd2lsbCBzdGlsbCBiZSB1c2luZyB0aGUgQ0xJIG9mIHRoZSB0aGVcbiAgICogKnByZXZpb3VzKiB2ZXJzaW9uIHRoYXQgd2FzIGluIHRoaXMgcHJvcGVydHk6IGl0IHdpbGwgb25seSBzdGFydCB1c2luZyB0aGVcbiAgICogbmV3IHZlcnNpb24gYWZ0ZXIgYFNlbGZNdXRhdGVgIGNvbXBsZXRlcyBzdWNjZXNzZnVsbHkuIFRoYXQgbWVhbnMgdGhhdCBpZlxuICAgKiB5b3Ugd2FudCB0byB1cGRhdGUgYm90aCBmcmFtZXdvcmsgYW5kIENMSSB2ZXJzaW9uLCB5b3Ugc2hvdWxkIHVwZGF0ZSB0aGVcbiAgICogQ0xJIHZlcnNpb24gZmlyc3QsIGNvbW1pdCwgcHVzaCBhbmQgZGVwbG95LCBhbmQgb25seSB0aGVuIHVwZGF0ZSB0aGVcbiAgICogZnJhbWV3b3JrIHZlcnNpb24uXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTGF0ZXN0IHZlcnNpb25cbiAgICovXG4gIHJlYWRvbmx5IGNsaVZlcnNpb24/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIHBpcGVsaW5lIHdpbGwgdXBkYXRlIGl0c2VsZlxuICAgKlxuICAgKiBUaGlzIG5lZWRzIHRvIGJlIHNldCB0byBgdHJ1ZWAgdG8gYWxsb3cgdGhlIHBpcGVsaW5lIHRvIHJlY29uZmlndXJlXG4gICAqIGl0c2VsZiB3aGVuIGFzc2V0cyBvciBzdGFnZXMgYXJlIGJlaW5nIGFkZGVkIHRvIGl0LCBhbmQgYHRydWVgIGlzIHRoZVxuICAgKiByZWNvbW1lbmRlZCBzZXR0aW5nLlxuICAgKlxuICAgKiBZb3UgY2FuIHRlbXBvcmFyaWx5IHNldCB0aGlzIHRvIGBmYWxzZWAgd2hpbGUgeW91IGFyZSBpdGVyYXRpbmdcbiAgICogb24gdGhlIHBpcGVsaW5lIGl0c2VsZiBhbmQgcHJlZmVyIHRvIGRlcGxveSBjaGFuZ2VzIHVzaW5nIGBjZGsgZGVwbG95YC5cbiAgICpcbiAgICogQGRlZmF1bHQgdHJ1ZVxuICAgKi9cbiAgcmVhZG9ubHkgc2VsZk11dGF0aW9uPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogRW5hYmxlIERvY2tlciBmb3IgdGhlIHNlbGYtbXV0YXRlIHN0ZXBcbiAgICpcbiAgICogU2V0IHRoaXMgdG8gdHJ1ZSBpZiB0aGUgcGlwZWxpbmUgaXRzZWxmIHVzZXMgRG9ja2VyIGNvbnRhaW5lciBhc3NldHNcbiAgICogKGZvciBleGFtcGxlLCBpZiB5b3UgdXNlIGBMaW51eEJ1aWxkSW1hZ2UuZnJvbUFzc2V0KClgIGFzIHRoZSBidWlsZFxuICAgKiBpbWFnZSBvZiBhIENvZGVCdWlsZCBzdGVwIGluIHRoZSBwaXBlbGluZSkuXG4gICAqXG4gICAqIFlvdSBkbyBub3QgbmVlZCB0byBzZXQgaXQgaWYgeW91IGJ1aWxkIERvY2tlciBpbWFnZSBhc3NldHMgaW4gdGhlXG4gICAqIGFwcGxpY2F0aW9uIFN0YWdlcyBhbmQgU3RhY2tzIHRoYXQgYXJlICpkZXBsb3llZCogYnkgdGhpcyBwaXBlbGluZS5cbiAgICpcbiAgICogQ29uZmlndXJlcyBwcml2aWxlZ2VkIG1vZGUgZm9yIHRoZSBzZWxmLW11dGF0aW9uIENvZGVCdWlsZCBhY3Rpb24uXG4gICAqXG4gICAqIElmIHlvdSBhcmUgYWJvdXQgdG8gdHVybiB0aGlzIG9uIGluIGFuIGFscmVhZHktZGVwbG95ZWQgUGlwZWxpbmUsXG4gICAqIHNldCB0aGUgdmFsdWUgdG8gYHRydWVgIGZpcnN0LCBjb21taXQgYW5kIGFsbG93IHRoZSBwaXBlbGluZSB0b1xuICAgKiBzZWxmLXVwZGF0ZSwgYW5kIG9ubHkgdGhlbiB1c2UgdGhlIERvY2tlciBhc3NldCBpbiB0aGUgcGlwZWxpbmUuXG4gICAqXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICByZWFkb25seSBkb2NrZXJFbmFibGVkRm9yU2VsZk11dGF0aW9uPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogRW5hYmxlIERvY2tlciBmb3IgdGhlICdzeW50aCcgc3RlcFxuICAgKlxuICAgKiBTZXQgdGhpcyB0byB0cnVlIGlmIHlvdSBhcmUgdXNpbmcgZmlsZSBhc3NldHMgdGhhdCByZXF1aXJlXG4gICAqIFwiYnVuZGxpbmdcIiBhbnl3aGVyZSBpbiB5b3VyIGFwcGxpY2F0aW9uIChtZWFuaW5nIGFuIGFzc2V0XG4gICAqIGNvbXBpbGF0aW9uIHN0ZXAgd2lsbCBiZSBydW4gd2l0aCB0aGUgdG9vbHMgcHJvdmlkZWQgYnlcbiAgICogYSBEb2NrZXIgaW1hZ2UpLCBib3RoIGZvciB0aGUgUGlwZWxpbmUgc3RhY2sgYXMgd2VsbCBhcyB0aGVcbiAgICogYXBwbGljYXRpb24gc3RhY2tzLlxuICAgKlxuICAgKiBBIGNvbW1vbiB3YXkgdG8gdXNlIGJ1bmRsaW5nIGFzc2V0cyBpbiB5b3VyIGFwcGxpY2F0aW9uIGlzIGJ5XG4gICAqIHVzaW5nIHRoZSBgQGF3cy1jZGsvYXdzLWxhbWJkYS1ub2RlanNgIGxpYnJhcnkuXG4gICAqXG4gICAqIENvbmZpZ3VyZXMgcHJpdmlsZWdlZCBtb2RlIGZvciB0aGUgc3ludGggQ29kZUJ1aWxkIGFjdGlvbi5cbiAgICpcbiAgICogSWYgeW91IGFyZSBhYm91dCB0byB0dXJuIHRoaXMgb24gaW4gYW4gYWxyZWFkeS1kZXBsb3llZCBQaXBlbGluZSxcbiAgICogc2V0IHRoZSB2YWx1ZSB0byBgdHJ1ZWAgZmlyc3QsIGNvbW1pdCBhbmQgYWxsb3cgdGhlIHBpcGVsaW5lIHRvXG4gICAqIHNlbGYtdXBkYXRlLCBhbmQgb25seSB0aGVuIHVzZSB0aGUgYnVuZGxlZCBhc3NldC5cbiAgICpcbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHJlYWRvbmx5IGRvY2tlckVuYWJsZWRGb3JTeW50aD86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEN1c3RvbWl6ZSB0aGUgQ29kZUJ1aWxkIHByb2plY3RzIGNyZWF0ZWQgZm9yIHRoaXMgcGlwZWxpbmVcbiAgICpcbiAgICogQGRlZmF1bHQgLSBBbGwgcHJvamVjdHMgcnVuIG5vbi1wcml2aWxlZ2VkIGJ1aWxkLCBTTUFMTCBpbnN0YW5jZSwgTGludXhCdWlsZEltYWdlLlNUQU5EQVJEXzVfMFxuICAgKi9cbiAgcmVhZG9ubHkgY29kZUJ1aWxkRGVmYXVsdHM/OiBDb2RlQnVpbGRPcHRpb25zO1xuXG4gIC8qKlxuICAgKiBBZGRpdGlvbmFsIGN1c3RvbWl6YXRpb25zIHRvIGFwcGx5IHRvIHRoZSBzeW50aGVzaXplIENvZGVCdWlsZCBwcm9qZWN0c1xuICAgKlxuICAgKiBAZGVmYXVsdCAtIE9ubHkgYGNvZGVCdWlsZERlZmF1bHRzYCBhcmUgYXBwbGllZFxuICAgKi9cbiAgcmVhZG9ubHkgc3ludGhDb2RlQnVpbGREZWZhdWx0cz86IENvZGVCdWlsZE9wdGlvbnM7XG5cbiAgLyoqXG4gICAqIEFkZGl0aW9uYWwgY3VzdG9taXphdGlvbnMgdG8gYXBwbHkgdG8gdGhlIGFzc2V0IHB1Ymxpc2hpbmcgQ29kZUJ1aWxkIHByb2plY3RzXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gT25seSBgY29kZUJ1aWxkRGVmYXVsdHNgIGFyZSBhcHBsaWVkXG4gICAqL1xuICByZWFkb25seSBhc3NldFB1Ymxpc2hpbmdDb2RlQnVpbGREZWZhdWx0cz86IENvZGVCdWlsZE9wdGlvbnM7XG5cbiAgLyoqXG4gICAqIEFkZGl0aW9uYWwgY3VzdG9taXphdGlvbnMgdG8gYXBwbHkgdG8gdGhlIHNlbGYgbXV0YXRpb24gQ29kZUJ1aWxkIHByb2plY3RzXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gT25seSBgY29kZUJ1aWxkRGVmYXVsdHNgIGFyZSBhcHBsaWVkXG4gICAqL1xuICByZWFkb25seSBzZWxmTXV0YXRpb25Db2RlQnVpbGREZWZhdWx0cz86IENvZGVCdWlsZE9wdGlvbnM7XG5cbiAgLyoqXG4gICAqIFB1Ymxpc2ggYXNzZXRzIGluIG11bHRpcGxlIENvZGVCdWlsZCBwcm9qZWN0c1xuICAgKlxuICAgKiBJZiBzZXQgdG8gZmFsc2UsIHVzZSBvbmUgUHJvamVjdCBwZXIgdHlwZSB0byBwdWJsaXNoIGFsbCBhc3NldHMuXG4gICAqXG4gICAqIFB1Ymxpc2hpbmcgaW4gcGFyYWxsZWwgaW1wcm92ZXMgY29uY3VycmVuY3kgYW5kIG1heSByZWR1Y2UgcHVibGlzaGluZ1xuICAgKiBsYXRlbmN5LCBidXQgbWF5IGFsc28gaW5jcmVhc2Ugb3ZlcmFsbCBwcm92aXNpb25pbmcgdGltZSBvZiB0aGUgQ29kZUJ1aWxkXG4gICAqIHByb2plY3RzLlxuICAgKlxuICAgKiBFeHBlcmltZW50IGFuZCBzZWUgd2hhdCB2YWx1ZSB3b3JrcyBiZXN0IGZvciB5b3UuXG4gICAqXG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICovXG4gIHJlYWRvbmx5IHB1Ymxpc2hBc3NldHNJblBhcmFsbGVsPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogQSBsaXN0IG9mIGNyZWRlbnRpYWxzIHVzZWQgdG8gYXV0aGVudGljYXRlIHRvIERvY2tlciByZWdpc3RyaWVzLlxuICAgKlxuICAgKiBTcGVjaWZ5IGFueSBjcmVkZW50aWFscyBuZWNlc3Nhcnkgd2l0aGluIHRoZSBwaXBlbGluZSB0byBidWlsZCwgc3ludGgsIHVwZGF0ZSwgb3IgcHVibGlzaCBhc3NldHMuXG4gICAqXG4gICAqIEBkZWZhdWx0IFtdXG4gICAqL1xuICByZWFkb25seSBkb2NrZXJDcmVkZW50aWFscz86IERvY2tlckNyZWRlbnRpYWxbXTtcblxuICAvKipcbiAgICogQW4gZXhpc3RpbmcgUGlwZWxpbmUgdG8gYmUgcmV1c2VkIGFuZCBidWlsdCB1cG9uLlxuICAgKlxuICAgKiBbZGlzYWJsZS1hd3NsaW50OnJlZi12aWEtaW50ZXJmYWNlXVxuICAgKlxuICAgKiBAZGVmYXVsdCAtIGEgbmV3IHVuZGVybHlpbmcgcGlwZWxpbmUgaXMgY3JlYXRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGNvZGVQaXBlbGluZT86IGNwLlBpcGVsaW5lO1xuXG4gIC8qKlxuICAgKiBSZXVzZSB0aGUgc2FtZSBjcm9zcyByZWdpb24gc3VwcG9ydCBzdGFjayBmb3IgYWxsIHBpcGVsaW5lcyBpbiB0aGUgQXBwLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIHRydWUgKFVzZSB0aGUgc2FtZSBzdXBwb3J0IHN0YWNrIGZvciBhbGwgcGlwZWxpbmVzIGluIEFwcClcbiAgICovXG4gIHJlYWRvbmx5IHJldXNlQ3Jvc3NSZWdpb25TdXBwb3J0U3RhY2tzPzogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBPcHRpb25zIGZvciBjdXN0b21pemluZyBhIHNpbmdsZSBDb2RlQnVpbGQgcHJvamVjdFxuICovXG5leHBvcnQgaW50ZXJmYWNlIENvZGVCdWlsZE9wdGlvbnMge1xuICAvKipcbiAgICogUGFydGlhbCBidWlsZCBlbnZpcm9ubWVudCwgd2lsbCBiZSBjb21iaW5lZCB3aXRoIG90aGVyIGJ1aWxkIGVudmlyb25tZW50cyB0aGF0IGFwcGx5XG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm9uLXByaXZpbGVnZWQgYnVpbGQsIFNNQUxMIGluc3RhbmNlLCBMaW51eEJ1aWxkSW1hZ2UuU1RBTkRBUkRfNV8wXG4gICAqL1xuICByZWFkb25seSBidWlsZEVudmlyb25tZW50PzogY2IuQnVpbGRFbnZpcm9ubWVudDtcblxuICAvKipcbiAgICogUG9saWN5IHN0YXRlbWVudHMgdG8gYWRkIHRvIHJvbGVcbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBwb2xpY3kgc3RhdGVtZW50cyBhZGRlZCB0byBDb2RlQnVpbGQgUHJvamVjdCBSb2xlXG4gICAqL1xuICByZWFkb25seSByb2xlUG9saWN5PzogaWFtLlBvbGljeVN0YXRlbWVudFtdO1xuXG4gIC8qKlxuICAgKiBQYXJ0aWFsIGJ1aWxkc3BlYywgd2lsbCBiZSBjb21iaW5lZCB3aXRoIG90aGVyIGJ1aWxkc3BlY3MgdGhhdCBhcHBseVxuICAgKlxuICAgKiBUaGUgQnVpbGRTcGVjIG11c3QgYmUgYXZhaWxhYmxlIGlubGluZS0taXQgY2Fubm90IHJlZmVyZW5jZSBhIGZpbGVcbiAgICogb24gZGlzay5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBpbml0aWFsIEJ1aWxkU3BlY1xuICAgKi9cbiAgcmVhZG9ubHkgcGFydGlhbEJ1aWxkU3BlYz86IGNiLkJ1aWxkU3BlYztcblxuICAvKipcbiAgICogV2hpY2ggc2VjdXJpdHkgZ3JvdXAocykgdG8gYXNzb2NpYXRlIHdpdGggdGhlIHByb2plY3QgbmV0d29yayBpbnRlcmZhY2VzLlxuICAgKlxuICAgKiBPbmx5IHVzZWQgaWYgJ3ZwYycgaXMgc3VwcGxpZWQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gU2VjdXJpdHkgZ3JvdXAgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGNyZWF0ZWQuXG4gICAqL1xuICByZWFkb25seSBzZWN1cml0eUdyb3Vwcz86IGVjMi5JU2VjdXJpdHlHcm91cFtdO1xuXG4gIC8qKlxuICAgKiBUaGUgVlBDIHdoZXJlIHRvIGNyZWF0ZSB0aGUgQ29kZUJ1aWxkIG5ldHdvcmsgaW50ZXJmYWNlcyBpbi5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBWUENcbiAgICovXG4gIHJlYWRvbmx5IHZwYz86IGVjMi5JVnBjO1xuXG4gIC8qKlxuICAgKiBXaGljaCBzdWJuZXRzIHRvIHVzZS5cbiAgICpcbiAgICogT25seSB1c2VkIGlmICd2cGMnIGlzIHN1cHBsaWVkLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIEFsbCBwcml2YXRlIHN1Ym5ldHMuXG4gICAqL1xuICByZWFkb25seSBzdWJuZXRTZWxlY3Rpb24/OiBlYzIuU3VibmV0U2VsZWN0aW9uO1xuXG4gIC8qKlxuICAgKiBUaGUgbnVtYmVyIG9mIG1pbnV0ZXMgYWZ0ZXIgd2hpY2ggQVdTIENvZGVCdWlsZCBzdG9wcyB0aGUgYnVpbGQgaWYgaXQnc1xuICAgKiBub3QgY29tcGxldGUuIEZvciB2YWxpZCB2YWx1ZXMsIHNlZSB0aGUgdGltZW91dEluTWludXRlcyBmaWVsZCBpbiB0aGUgQVdTXG4gICAqIENvZGVCdWlsZCBVc2VyIEd1aWRlLlxuICAgKlxuICAgKiBAZGVmYXVsdCBEdXJhdGlvbi5ob3VycygxKVxuICAgKi9cbiAgcmVhZG9ubHkgdGltZW91dD86IER1cmF0aW9uO1xufVxuXG5cbi8qKlxuICogQSBDREsgUGlwZWxpbmUgdGhhdCB1c2VzIENvZGVQaXBlbGluZSB0byBkZXBsb3kgQ0RLIGFwcHNcbiAqXG4gKiBUaGlzIGlzIGEgYFBpcGVsaW5lYCB3aXRoIGl0cyBgZW5naW5lYCBwcm9wZXJ0eSBzZXQgdG9cbiAqIGBDb2RlUGlwZWxpbmVFbmdpbmVgLCBhbmQgZXhpc3RzIGZvciBuaWNlciBlcmdvbm9taWNzIGZvclxuICogdXNlcnMgdGhhdCBkb24ndCBuZWVkIHRvIHN3aXRjaCBvdXQgZW5naW5lcy5cbiAqL1xuZXhwb3J0IGNsYXNzIENvZGVQaXBlbGluZSBleHRlbmRzIFBpcGVsaW5lQmFzZSB7XG4gIHByaXZhdGUgX3BpcGVsaW5lPzogY3AuUGlwZWxpbmU7XG4gIHByaXZhdGUgYXJ0aWZhY3RzID0gbmV3IEFydGlmYWN0TWFwKCk7XG4gIHByaXZhdGUgX3N5bnRoUHJvamVjdD86IGNiLklQcm9qZWN0O1xuICBwcml2YXRlIHJlYWRvbmx5IHNlbGZNdXRhdGlvbjogYm9vbGVhbjtcbiAgcHJpdmF0ZSBfbXlDeEFzbVJvb3Q/OiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgZG9ja2VyQ3JlZGVudGlhbHM6IERvY2tlckNyZWRlbnRpYWxbXTtcblxuICAvKipcbiAgICogQXNzZXQgcm9sZXMgc2hhcmVkIGZvciBwdWJsaXNoaW5nXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IGFzc2V0Q29kZUJ1aWxkUm9sZXM6IFJlY29yZDxzdHJpbmcsIGlhbS5JUm9sZT4gPSB7fTtcblxuICAvKipcbiAgICogUGVyIGFzc2V0IHR5cGUsIHRoZSB0YXJnZXQgcm9sZSBBUk5zIHRoYXQgbmVlZCB0byBiZSBhc3N1bWVkXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IGFzc2V0UHVibGlzaGluZ1JvbGVzOiBSZWNvcmQ8c3RyaW5nLCBTZXQ8c3RyaW5nPj4gPSB7fTtcblxuICAvKipcbiAgICogVGhpcyBpcyBzZXQgdG8gdGhlIHZlcnkgZmlyc3QgYXJ0aWZhY3QgcHJvZHVjZWQgaW4gdGhlIHBpcGVsaW5lXG4gICAqL1xuICBwcml2YXRlIF9mYWxsYmFja0FydGlmYWN0PzogY3AuQXJ0aWZhY3Q7XG5cbiAgcHJpdmF0ZSBfY2xvdWRBc3NlbWJseUZpbGVTZXQ/OiBGaWxlU2V0O1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgc2luZ2xlUHVibGlzaGVyUGVyQXNzZXRUeXBlOiBib29sZWFuO1xuICBwcml2YXRlIHJlYWRvbmx5IGNsaVZlcnNpb24/OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJpdmF0ZSByZWFkb25seSBwcm9wczogQ29kZVBpcGVsaW5lUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQsIHByb3BzKTtcblxuICAgIHRoaXMuc2VsZk11dGF0aW9uID0gcHJvcHMuc2VsZk11dGF0aW9uID8/IHRydWU7XG4gICAgdGhpcy5kb2NrZXJDcmVkZW50aWFscyA9IHByb3BzLmRvY2tlckNyZWRlbnRpYWxzID8/IFtdO1xuICAgIHRoaXMuc2luZ2xlUHVibGlzaGVyUGVyQXNzZXRUeXBlID0gIShwcm9wcy5wdWJsaXNoQXNzZXRzSW5QYXJhbGxlbCA/PyB0cnVlKTtcbiAgICB0aGlzLmNsaVZlcnNpb24gPSBwcm9wcy5jbGlWZXJzaW9uID8/IHByZWZlcnJlZENsaVZlcnNpb24oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgQ29kZUJ1aWxkIHByb2plY3QgdGhhdCBwZXJmb3JtcyB0aGUgU3ludGhcbiAgICpcbiAgICogT25seSBhdmFpbGFibGUgYWZ0ZXIgdGhlIHBpcGVsaW5lIGhhcyBiZWVuIGJ1aWx0LlxuICAgKi9cbiAgcHVibGljIGdldCBzeW50aFByb2plY3QoKTogY2IuSVByb2plY3Qge1xuICAgIGlmICghdGhpcy5fc3ludGhQcm9qZWN0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbGwgcGlwZWxpbmUuYnVpbGRQaXBlbGluZSgpIGJlZm9yZSByZWFkaW5nIHRoaXMgcHJvcGVydHknKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX3N5bnRoUHJvamVjdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgQ29kZVBpcGVsaW5lIHBpcGVsaW5lIHRoYXQgZGVwbG95cyB0aGUgQ0RLIGFwcFxuICAgKlxuICAgKiBPbmx5IGF2YWlsYWJsZSBhZnRlciB0aGUgcGlwZWxpbmUgaGFzIGJlZW4gYnVpbHQuXG4gICAqL1xuICBwdWJsaWMgZ2V0IHBpcGVsaW5lKCk6IGNwLlBpcGVsaW5lIHtcbiAgICBpZiAoIXRoaXMuX3BpcGVsaW5lKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BpcGVsaW5lIG5vdCBjcmVhdGVkIHlldCcpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fcGlwZWxpbmU7XG4gIH1cblxuXG4gIHByb3RlY3RlZCBkb0J1aWxkUGlwZWxpbmUoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX3BpcGVsaW5lKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BpcGVsaW5lIGFscmVhZHkgY3JlYXRlZCcpO1xuICAgIH1cblxuICAgIHRoaXMuX215Q3hBc21Sb290ID0gcGF0aC5yZXNvbHZlKGFzc2VtYmx5QnVpbGRlck9mKGFwcE9mKHRoaXMpKS5vdXRkaXIpO1xuXG4gICAgaWYgKHRoaXMucHJvcHMuY29kZVBpcGVsaW5lKSB7XG4gICAgICBpZiAodGhpcy5wcm9wcy5waXBlbGluZU5hbWUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3Qgc2V0IFxcJ3BpcGVsaW5lTmFtZVxcJyBpZiBhbiBleGlzdGluZyBDb2RlUGlwZWxpbmUgaXMgZ2l2ZW4gdXNpbmcgXFwnY29kZVBpcGVsaW5lXFwnJyk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5wcm9wcy5jcm9zc0FjY291bnRLZXlzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3Qgc2V0IFxcJ2Nyb3NzQWNjb3VudEtleXNcXCcgaWYgYW4gZXhpc3RpbmcgQ29kZVBpcGVsaW5lIGlzIGdpdmVuIHVzaW5nIFxcJ2NvZGVQaXBlbGluZVxcJycpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9waXBlbGluZSA9IHRoaXMucHJvcHMuY29kZVBpcGVsaW5lO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9waXBlbGluZSA9IG5ldyBjcC5QaXBlbGluZSh0aGlzLCAnUGlwZWxpbmUnLCB7XG4gICAgICAgIHBpcGVsaW5lTmFtZTogdGhpcy5wcm9wcy5waXBlbGluZU5hbWUsXG4gICAgICAgIGNyb3NzQWNjb3VudEtleXM6IHRoaXMucHJvcHMuY3Jvc3NBY2NvdW50S2V5cyA/PyBmYWxzZSxcbiAgICAgICAgcmV1c2VDcm9zc1JlZ2lvblN1cHBvcnRTdGFja3M6IHRoaXMucHJvcHMucmV1c2VDcm9zc1JlZ2lvblN1cHBvcnRTdGFja3MsXG4gICAgICAgIC8vIFRoaXMgaXMgbmVjZXNzYXJ5IHRvIG1ha2Ugc2VsZi1tdXRhdGlvbiB3b3JrIChkZXBsb3ltZW50cyBhcmUgZ3VhcmFudGVlZFxuICAgICAgICAvLyB0byBoYXBwZW4gb25seSBhZnRlciB0aGUgYnVpbGRzIG9mIHRoZSBsYXRlc3QgcGlwZWxpbmUgZGVmaW5pdGlvbikuXG4gICAgICAgIHJlc3RhcnRFeGVjdXRpb25PblVwZGF0ZTogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGdyYXBoRnJvbUJwID0gbmV3IFBpcGVsaW5lR3JhcGgodGhpcywge1xuICAgICAgc2VsZk11dGF0aW9uOiB0aGlzLnNlbGZNdXRhdGlvbixcbiAgICAgIHNpbmdsZVB1Ymxpc2hlclBlckFzc2V0VHlwZTogdGhpcy5zaW5nbGVQdWJsaXNoZXJQZXJBc3NldFR5cGUsXG4gICAgfSk7XG4gICAgdGhpcy5fY2xvdWRBc3NlbWJseUZpbGVTZXQgPSBncmFwaEZyb21CcC5jbG91ZEFzc2VtYmx5RmlsZVNldDtcblxuICAgIHRoaXMucGlwZWxpbmVTdGFnZXNBbmRBY3Rpb25zRnJvbUdyYXBoKGdyYXBoRnJvbUJwKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IG15Q3hBc21Sb290KCk6IHN0cmluZyB7XG4gICAgaWYgKCF0aGlzLl9teUN4QXNtUm9vdCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5cXCd0IHJlYWQgXFwnbXlDeEFzbVJvb3RcXCcgaWYgYnVpbGQgZGVwbG95bWVudCBub3QgY2FsbGVkIHlldCcpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fbXlDeEFzbVJvb3Q7XG4gIH1cblxuICAvKipcbiAgICogU2NvcGUgZm9yIEFzc2V0cy1yZWxhdGVkIHJlc291cmNlcy5cbiAgICpcbiAgICogUHVyZWx5IGV4aXN0cyBmb3IgY29uc3RydWN0IHRyZWUgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgd2l0aCBsZWdhY3kgcGlwZWxpbmVzXG4gICAqL1xuICBwcml2YXRlIGdldCBhc3NldHNTY29wZSgpOiBDb25zdHJ1Y3Qge1xuICAgIHJldHVybiBvYnRhaW5TY29wZSh0aGlzLCAnQXNzZXRzJyk7XG4gIH1cblxuICBwcml2YXRlIHBpcGVsaW5lU3RhZ2VzQW5kQWN0aW9uc0Zyb21HcmFwaChzdHJ1Y3R1cmU6IFBpcGVsaW5lR3JhcGgpIHtcbiAgICAvLyBUcmFuc2xhdGUgZ3JhcGggaW50byBQaXBlbGluZSBTdGFnZXMgYW5kIEFjdGlvbnNcbiAgICBsZXQgYmVmb3JlU2VsZk11dGF0aW9uID0gdGhpcy5zZWxmTXV0YXRpb247XG4gICAgZm9yIChjb25zdCBzdGFnZU5vZGUgb2YgZmxhdHRlbihzdHJ1Y3R1cmUuZ3JhcGguc29ydGVkQ2hpbGRyZW4oKSkpIHtcbiAgICAgIGlmICghaXNHcmFwaChzdGFnZU5vZGUpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVG9wLWxldmVsIGNoaWxkcmVuIG11c3QgYmUgZ3JhcGhzLCBnb3QgJyR7c3RhZ2VOb2RlfSdgKTtcbiAgICAgIH1cblxuICAgICAgLy8gR3JvdXAgb3VyIG9yZGVyZWQgdHJhbmNoZXMgaW50byBibG9ja3Mgb2YgNTAuXG4gICAgICAvLyBXZSBjYW4gbWFwIHRoZXNlIG9udG8gc3RhZ2VzIHdpdGhvdXQgZXhjZWVkaW5nIHRoZSBjYXBhY2l0eSBvZiBhIFN0YWdlLlxuICAgICAgY29uc3QgY2h1bmtzID0gY2h1bmtUcmFuY2hlcyg1MCwgc3RhZ2VOb2RlLnNvcnRlZExlYXZlcygpKTtcbiAgICAgIGNvbnN0IGFjdGlvbnNPdmVyZmxvd1N0YWdlID0gY2h1bmtzLmxlbmd0aCA+IDE7XG4gICAgICBmb3IgKGNvbnN0IFtpLCB0cmFuY2hlc10gb2YgZW51bWVyYXRlKGNodW5rcykpIHtcbiAgICAgICAgY29uc3Qgc3RhZ2VOYW1lID0gYWN0aW9uc092ZXJmbG93U3RhZ2UgPyBgJHtzdGFnZU5vZGUuaWR9LiR7aSArIDF9YCA6IHN0YWdlTm9kZS5pZDtcbiAgICAgICAgY29uc3QgcGlwZWxpbmVTdGFnZSA9IHRoaXMucGlwZWxpbmUuYWRkU3RhZ2UoeyBzdGFnZU5hbWUgfSk7XG5cbiAgICAgICAgY29uc3Qgc2hhcmVkUGFyZW50ID0gbmV3IEdyYXBoTm9kZUNvbGxlY3Rpb24oZmxhdHRlbih0cmFuY2hlcykpLmNvbW1vbkFuY2VzdG9yKCk7XG5cbiAgICAgICAgbGV0IHJ1bk9yZGVyID0gMTtcbiAgICAgICAgZm9yIChjb25zdCB0cmFuY2hlIG9mIHRyYW5jaGVzKSB7XG4gICAgICAgICAgY29uc3QgcnVuT3JkZXJzQ29uc3VtZWQgPSBbMF07XG5cbiAgICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgdHJhbmNoZSkge1xuICAgICAgICAgICAgY29uc3QgZmFjdG9yeSA9IHRoaXMuYWN0aW9uRnJvbU5vZGUobm9kZSk7XG5cbiAgICAgICAgICAgIGNvbnN0IG5vZGVUeXBlID0gdGhpcy5ub2RlVHlwZUZyb21Ob2RlKG5vZGUpO1xuICAgICAgICAgICAgY29uc3QgbmFtZSA9IGFjdGlvbk5hbWUobm9kZSwgc2hhcmVkUGFyZW50KTtcblxuICAgICAgICAgICAgY29uc3QgdmFyaWFibGVzTmFtZXNwYWNlID0gbm9kZS5kYXRhPy50eXBlID09PSAnc3RlcCdcbiAgICAgICAgICAgICAgPyBuYW1lc3BhY2VTdGVwT3V0cHV0cyhub2RlLmRhdGEuc3RlcCwgcGlwZWxpbmVTdGFnZSwgbmFtZSlcbiAgICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZhY3RvcnkucHJvZHVjZUFjdGlvbihwaXBlbGluZVN0YWdlLCB7XG4gICAgICAgICAgICAgIGFjdGlvbk5hbWU6IG5hbWUsXG4gICAgICAgICAgICAgIHJ1bk9yZGVyLFxuICAgICAgICAgICAgICBhcnRpZmFjdHM6IHRoaXMuYXJ0aWZhY3RzLFxuICAgICAgICAgICAgICBzY29wZTogb2J0YWluU2NvcGUodGhpcy5waXBlbGluZSwgc3RhZ2VOYW1lKSxcbiAgICAgICAgICAgICAgZmFsbGJhY2tBcnRpZmFjdDogdGhpcy5fZmFsbGJhY2tBcnRpZmFjdCxcbiAgICAgICAgICAgICAgcGlwZWxpbmU6IHRoaXMsXG4gICAgICAgICAgICAgIC8vIElmIHRoaXMgc3RlcCBoYXBwZW5zIHRvIHByb2R1Y2UgYSBDb2RlQnVpbGQgam9iLCBzZXQgdGhlIGRlZmF1bHQgb3B0aW9uc1xuICAgICAgICAgICAgICBjb2RlQnVpbGREZWZhdWx0czogbm9kZVR5cGUgPyB0aGlzLmNvZGVCdWlsZERlZmF1bHRzRm9yKG5vZGVUeXBlKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgYmVmb3JlU2VsZk11dGF0aW9uLFxuICAgICAgICAgICAgICB2YXJpYWJsZXNOYW1lc3BhY2UsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKG5vZGUuZGF0YT8udHlwZSA9PT0gJ3NlbGYtdXBkYXRlJykge1xuICAgICAgICAgICAgICBiZWZvcmVTZWxmTXV0YXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5wb3N0UHJvY2Vzc05vZGUobm9kZSwgcmVzdWx0KTtcblxuICAgICAgICAgICAgcnVuT3JkZXJzQ29uc3VtZWQucHVzaChyZXN1bHQucnVuT3JkZXJzQ29uc3VtZWQpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJ1bk9yZGVyICs9IE1hdGgubWF4KC4uLnJ1bk9yZGVyc0NvbnN1bWVkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEbyBhZGRpdGlvbmFsIHRoaW5ncyBhZnRlciB0aGUgYWN0aW9uIGdvdCBhZGRlZCB0byB0aGUgcGlwZWxpbmVcbiAgICpcbiAgICogU29tZSBtaW5vciBzdGF0ZSBtYW5pcHVsYXRpb24gb2YgQ29kZUJ1aWxkIHByb2plY3RzIGFuZCBwaXBlbGluZVxuICAgKiBhcnRpZmFjdHMuXG4gICAqL1xuICBwcml2YXRlIHBvc3RQcm9jZXNzTm9kZShub2RlOiBBR3JhcGhOb2RlLCByZXN1bHQ6IENvZGVQaXBlbGluZUFjdGlvbkZhY3RvcnlSZXN1bHQpIHtcbiAgICBjb25zdCBub2RlVHlwZSA9IHRoaXMubm9kZVR5cGVGcm9tTm9kZShub2RlKTtcblxuICAgIGlmIChyZXN1bHQucHJvamVjdCkge1xuICAgICAgY29uc3QgZG9ja2VyVXNhZ2UgPSBkb2NrZXJVc2FnZUZyb21Db2RlQnVpbGQobm9kZVR5cGUgPz8gQ29kZUJ1aWxkUHJvamVjdFR5cGUuU1RFUCk7XG4gICAgICBpZiAoZG9ja2VyVXNhZ2UpIHtcbiAgICAgICAgZm9yIChjb25zdCBjIG9mIHRoaXMuZG9ja2VyQ3JlZGVudGlhbHMpIHtcbiAgICAgICAgICBjLmdyYW50UmVhZChyZXN1bHQucHJvamVjdCwgZG9ja2VyVXNhZ2UpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChub2RlVHlwZSA9PT0gQ29kZUJ1aWxkUHJvamVjdFR5cGUuU1lOVEgpIHtcbiAgICAgICAgdGhpcy5fc3ludGhQcm9qZWN0ID0gcmVzdWx0LnByb2plY3Q7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG5vZGUuZGF0YT8udHlwZSA9PT0gJ3N0ZXAnICYmIG5vZGUuZGF0YS5zdGVwLnByaW1hcnlPdXRwdXQ/LnByaW1hcnlPdXRwdXQgJiYgIXRoaXMuX2ZhbGxiYWNrQXJ0aWZhY3QpIHtcbiAgICAgIHRoaXMuX2ZhbGxiYWNrQXJ0aWZhY3QgPSB0aGlzLmFydGlmYWN0cy50b0NvZGVQaXBlbGluZShub2RlLmRhdGEuc3RlcC5wcmltYXJ5T3V0cHV0Py5wcmltYXJ5T3V0cHV0KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTWFrZSBhbiBhY3Rpb24gZnJvbSB0aGUgZ2l2ZW4gbm9kZSBhbmQvb3Igc3RlcFxuICAgKi9cbiAgcHJpdmF0ZSBhY3Rpb25Gcm9tTm9kZShub2RlOiBBR3JhcGhOb2RlKTogSUNvZGVQaXBlbGluZUFjdGlvbkZhY3Rvcnkge1xuICAgIHN3aXRjaCAobm9kZS5kYXRhPy50eXBlKSB7XG4gICAgICAvLyBOb3RoaW5nIGZvciB0aGVzZSwgdGhleSBhcmUgZ3JvdXBpbmdzIChzaG91bGRuJ3QgZXZlbiBoYXZlIHBvcHBlZCB1cCBoZXJlKVxuICAgICAgY2FzZSAnZ3JvdXAnOlxuICAgICAgY2FzZSAnc3RhY2stZ3JvdXAnOlxuICAgICAgY2FzZSB1bmRlZmluZWQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgYWN0aW9uRnJvbU5vZGU6IGRpZCBub3QgZXhwZWN0IHRvIGdldCBncm91cCBub2RlczogJHtub2RlLmRhdGE/LnR5cGV9YCk7XG5cbiAgICAgIGNhc2UgJ3NlbGYtdXBkYXRlJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZk11dGF0ZUFjdGlvbigpO1xuXG4gICAgICBjYXNlICdwdWJsaXNoLWFzc2V0cyc6XG4gICAgICAgIHJldHVybiB0aGlzLnB1Ymxpc2hBc3NldHNBY3Rpb24obm9kZSwgbm9kZS5kYXRhLmFzc2V0cyk7XG5cbiAgICAgIGNhc2UgJ3ByZXBhcmUnOlxuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVDaGFuZ2VTZXRBY3Rpb24obm9kZS5kYXRhLnN0YWNrKTtcblxuICAgICAgY2FzZSAnZXhlY3V0ZSc6XG4gICAgICAgIHJldHVybiB0aGlzLmV4ZWN1dGVDaGFuZ2VTZXRBY3Rpb24obm9kZS5kYXRhLnN0YWNrLCBub2RlLmRhdGEuY2FwdHVyZU91dHB1dHMpO1xuXG4gICAgICBjYXNlICdzdGVwJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuYWN0aW9uRnJvbVN0ZXAobm9kZSwgbm9kZS5kYXRhLnN0ZXApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUYWtlIGEgU3RlcCBhbmQgdHVybiBpdCBpbnRvIGEgQ29kZVBpcGVsaW5lIEFjdGlvblxuICAgKlxuICAgKiBUaGVyZSBhcmUgb25seSAzIHR5cGVzIG9mIFN0ZXBzIHdlIG5lZWQgdG8gc3VwcG9ydDpcbiAgICpcbiAgICogLSBTaGVsbCAoZ2VuZXJpYylcbiAgICogLSBNYW51YWxBcHByb3ZhbCAoZ2VuZXJpYylcbiAgICogLSBDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5IChDb2RlUGlwZWxpbmUtc3BlY2lmaWMpXG4gICAqXG4gICAqIFRoZSByZXN0IGlzIGV4cHJlc3NlZCBpbiB0ZXJtcyBvZiB0aGVzZSAzLCBvciBpbiB0ZXJtcyBvZiBncmFwaCBub2Rlc1xuICAgKiB3aGljaCBhcmUgaGFuZGxlZCBlbHNld2hlcmUuXG4gICAqL1xuICBwcml2YXRlIGFjdGlvbkZyb21TdGVwKG5vZGU6IEFHcmFwaE5vZGUsIHN0ZXA6IFN0ZXApOiBJQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSB7XG4gICAgY29uc3Qgbm9kZVR5cGUgPSB0aGlzLm5vZGVUeXBlRnJvbU5vZGUobm9kZSk7XG5cbiAgICAvLyBDb2RlUGlwZWxpbmUtc3BlY2lmaWMgc3RlcHMgZmlyc3QgLS0gdGhpcyBpbmNsdWRlcyBTb3VyY2VzXG4gICAgaWYgKGlzQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeShzdGVwKSkge1xuICAgICAgcmV0dXJuIHN0ZXA7XG4gICAgfVxuXG4gICAgLy8gTm93IGJ1aWx0LWluIHN0ZXBzXG4gICAgaWYgKHN0ZXAgaW5zdGFuY2VvZiBTaGVsbFN0ZXAgfHwgc3RlcCBpbnN0YW5jZW9mIENvZGVCdWlsZFN0ZXApIHtcbiAgICAgIC8vIFRoZSAnQ2RrQnVpbGRQcm9qZWN0JyB3aWxsIGJlIHRoZSBjb25zdHJ1Y3QgSUQgb2YgdGhlIENvZGVCdWlsZCBwcm9qZWN0LCBuZWNlc3NhcnkgZm9yIGJhY2t3YXJkcyBjb21wYXRcbiAgICAgIGxldCBjb25zdHJ1Y3RJZCA9IG5vZGVUeXBlID09PSBDb2RlQnVpbGRQcm9qZWN0VHlwZS5TWU5USFxuICAgICAgICA/ICdDZGtCdWlsZFByb2plY3QnXG4gICAgICAgIDogc3RlcC5pZDtcblxuICAgICAgcmV0dXJuIHN0ZXAgaW5zdGFuY2VvZiBDb2RlQnVpbGRTdGVwXG4gICAgICAgID8gQ29kZUJ1aWxkRmFjdG9yeS5mcm9tQ29kZUJ1aWxkU3RlcChjb25zdHJ1Y3RJZCwgc3RlcClcbiAgICAgICAgOiBDb2RlQnVpbGRGYWN0b3J5LmZyb21TaGVsbFN0ZXAoY29uc3RydWN0SWQsIHN0ZXApO1xuICAgIH1cblxuICAgIGlmIChzdGVwIGluc3RhbmNlb2YgTWFudWFsQXBwcm92YWxTdGVwKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBwcm9kdWNlQWN0aW9uOiAoc3RhZ2UsIG9wdGlvbnMpID0+IHtcbiAgICAgICAgICBzdGFnZS5hZGRBY3Rpb24obmV3IGNwYS5NYW51YWxBcHByb3ZhbEFjdGlvbih7XG4gICAgICAgICAgICBhY3Rpb25OYW1lOiBvcHRpb25zLmFjdGlvbk5hbWUsXG4gICAgICAgICAgICBydW5PcmRlcjogb3B0aW9ucy5ydW5PcmRlcixcbiAgICAgICAgICAgIGFkZGl0aW9uYWxJbmZvcm1hdGlvbjogc3RlcC5jb21tZW50LFxuICAgICAgICAgIH0pKTtcbiAgICAgICAgICByZXR1cm4geyBydW5PcmRlcnNDb25zdW1lZDogMSB9O1xuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoYERlcGxveW1lbnQgc3RlcCAnJHtzdGVwfScgaXMgbm90IHN1cHBvcnRlZCBmb3IgQ29kZVBpcGVsaW5lLWJhY2tlZCBwaXBlbGluZXNgKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlQ2hhbmdlU2V0QWN0aW9uKHN0YWNrOiBTdGFja0RlcGxveW1lbnQpOiBJQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSB7XG4gICAgY29uc3QgY2hhbmdlU2V0TmFtZSA9ICdQaXBlbGluZUNoYW5nZSc7XG5cbiAgICBjb25zdCB0ZW1wbGF0ZUFydGlmYWN0ID0gdGhpcy5hcnRpZmFjdHMudG9Db2RlUGlwZWxpbmUodGhpcy5fY2xvdWRBc3NlbWJseUZpbGVTZXQhKTtcbiAgICBjb25zdCB0ZW1wbGF0ZUNvbmZpZ3VyYXRpb25QYXRoID0gdGhpcy53cml0ZVRlbXBsYXRlQ29uZmlndXJhdGlvbihzdGFjayk7XG5cbiAgICBjb25zdCByZWdpb24gPSBzdGFjay5yZWdpb24gIT09IFN0YWNrLm9mKHRoaXMpLnJlZ2lvbiA/IHN0YWNrLnJlZ2lvbiA6IHVuZGVmaW5lZDtcbiAgICBjb25zdCBhY2NvdW50ID0gc3RhY2suYWNjb3VudCAhPT0gU3RhY2sub2YodGhpcykuYWNjb3VudCA/IHN0YWNrLmFjY291bnQgOiB1bmRlZmluZWQ7XG5cbiAgICBjb25zdCByZWxhdGl2ZVRlbXBsYXRlUGF0aCA9IHBhdGgucmVsYXRpdmUodGhpcy5teUN4QXNtUm9vdCwgc3RhY2suYWJzb2x1dGVUZW1wbGF0ZVBhdGgpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHByb2R1Y2VBY3Rpb246IChzdGFnZSwgb3B0aW9ucykgPT4ge1xuICAgICAgICBzdGFnZS5hZGRBY3Rpb24obmV3IGNwYS5DbG91ZEZvcm1hdGlvbkNyZWF0ZVJlcGxhY2VDaGFuZ2VTZXRBY3Rpb24oe1xuICAgICAgICAgIGFjdGlvbk5hbWU6IG9wdGlvbnMuYWN0aW9uTmFtZSxcbiAgICAgICAgICBydW5PcmRlcjogb3B0aW9ucy5ydW5PcmRlcixcbiAgICAgICAgICBjaGFuZ2VTZXROYW1lLFxuICAgICAgICAgIHN0YWNrTmFtZTogc3RhY2suc3RhY2tOYW1lLFxuICAgICAgICAgIHRlbXBsYXRlUGF0aDogdGVtcGxhdGVBcnRpZmFjdC5hdFBhdGgodG9Qb3NpeFBhdGgocmVsYXRpdmVUZW1wbGF0ZVBhdGgpKSxcbiAgICAgICAgICBhZG1pblBlcm1pc3Npb25zOiB0cnVlLFxuICAgICAgICAgIHJvbGU6IHRoaXMucm9sZUZyb21QbGFjZWhvbGRlckFybih0aGlzLnBpcGVsaW5lLCByZWdpb24sIGFjY291bnQsIHN0YWNrLmFzc3VtZVJvbGVBcm4pLFxuICAgICAgICAgIGRlcGxveW1lbnRSb2xlOiB0aGlzLnJvbGVGcm9tUGxhY2Vob2xkZXJBcm4odGhpcy5waXBlbGluZSwgcmVnaW9uLCBhY2NvdW50LCBzdGFjay5leGVjdXRpb25Sb2xlQXJuKSxcbiAgICAgICAgICByZWdpb246IHJlZ2lvbixcbiAgICAgICAgICB0ZW1wbGF0ZUNvbmZpZ3VyYXRpb246IHRlbXBsYXRlQ29uZmlndXJhdGlvblBhdGhcbiAgICAgICAgICAgID8gdGVtcGxhdGVBcnRpZmFjdC5hdFBhdGgodG9Qb3NpeFBhdGgodGVtcGxhdGVDb25maWd1cmF0aW9uUGF0aCkpXG4gICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgICBjZm5DYXBhYmlsaXRpZXM6IFtDZm5DYXBhYmlsaXRpZXMuTkFNRURfSUFNLCBDZm5DYXBhYmlsaXRpZXMuQVVUT19FWFBBTkRdLFxuICAgICAgICB9KSk7XG4gICAgICAgIHJldHVybiB7IHJ1bk9yZGVyc0NvbnN1bWVkOiAxIH07XG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGV4ZWN1dGVDaGFuZ2VTZXRBY3Rpb24oc3RhY2s6IFN0YWNrRGVwbG95bWVudCwgY2FwdHVyZU91dHB1dHM6IGJvb2xlYW4pOiBJQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSB7XG4gICAgY29uc3QgY2hhbmdlU2V0TmFtZSA9ICdQaXBlbGluZUNoYW5nZSc7XG5cbiAgICBjb25zdCByZWdpb24gPSBzdGFjay5yZWdpb24gIT09IFN0YWNrLm9mKHRoaXMpLnJlZ2lvbiA/IHN0YWNrLnJlZ2lvbiA6IHVuZGVmaW5lZDtcbiAgICBjb25zdCBhY2NvdW50ID0gc3RhY2suYWNjb3VudCAhPT0gU3RhY2sub2YodGhpcykuYWNjb3VudCA/IHN0YWNrLmFjY291bnQgOiB1bmRlZmluZWQ7XG5cbiAgICByZXR1cm4ge1xuICAgICAgcHJvZHVjZUFjdGlvbjogKHN0YWdlLCBvcHRpb25zKSA9PiB7XG4gICAgICAgIHN0YWdlLmFkZEFjdGlvbihuZXcgY3BhLkNsb3VkRm9ybWF0aW9uRXhlY3V0ZUNoYW5nZVNldEFjdGlvbih7XG4gICAgICAgICAgYWN0aW9uTmFtZTogb3B0aW9ucy5hY3Rpb25OYW1lLFxuICAgICAgICAgIHJ1bk9yZGVyOiBvcHRpb25zLnJ1bk9yZGVyLFxuICAgICAgICAgIGNoYW5nZVNldE5hbWUsXG4gICAgICAgICAgc3RhY2tOYW1lOiBzdGFjay5zdGFja05hbWUsXG4gICAgICAgICAgcm9sZTogdGhpcy5yb2xlRnJvbVBsYWNlaG9sZGVyQXJuKHRoaXMucGlwZWxpbmUsIHJlZ2lvbiwgYWNjb3VudCwgc3RhY2suYXNzdW1lUm9sZUFybiksXG4gICAgICAgICAgcmVnaW9uOiByZWdpb24sXG4gICAgICAgICAgdmFyaWFibGVzTmFtZXNwYWNlOiBjYXB0dXJlT3V0cHV0cyA/IHN0YWNrVmFyaWFibGVOYW1lc3BhY2Uoc3RhY2spIDogdW5kZWZpbmVkLFxuICAgICAgICB9KSk7XG5cbiAgICAgICAgcmV0dXJuIHsgcnVuT3JkZXJzQ29uc3VtZWQ6IDEgfTtcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgc2VsZk11dGF0ZUFjdGlvbigpOiBJQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSB7XG4gICAgY29uc3QgaW5zdGFsbFN1ZmZpeCA9IHRoaXMuY2xpVmVyc2lvbiA/IGBAJHt0aGlzLmNsaVZlcnNpb259YCA6ICcnO1xuXG4gICAgY29uc3QgcGlwZWxpbmVTdGFjayA9IFN0YWNrLm9mKHRoaXMucGlwZWxpbmUpO1xuICAgIGNvbnN0IHBpcGVsaW5lU3RhY2tJZGVudGlmaWVyID0gcGlwZWxpbmVTdGFjay5ub2RlLnBhdGggPz8gcGlwZWxpbmVTdGFjay5zdGFja05hbWU7XG5cbiAgICBjb25zdCBzdGVwID0gbmV3IENvZGVCdWlsZFN0ZXAoJ1NlbGZNdXRhdGUnLCB7XG4gICAgICBwcm9qZWN0TmFtZTogbWF5YmVTdWZmaXgodGhpcy5wcm9wcy5waXBlbGluZU5hbWUsICctc2VsZnVwZGF0ZScpLFxuICAgICAgaW5wdXQ6IHRoaXMuX2Nsb3VkQXNzZW1ibHlGaWxlU2V0LFxuICAgICAgaW5zdGFsbENvbW1hbmRzOiBbXG4gICAgICAgIGBucG0gaW5zdGFsbCAtZyBhd3MtY2RrJHtpbnN0YWxsU3VmZml4fWAsXG4gICAgICBdLFxuICAgICAgY29tbWFuZHM6IFtcbiAgICAgICAgYGNkayAtYSAke3RvUG9zaXhQYXRoKGVtYmVkZGVkQXNtUGF0aCh0aGlzLnBpcGVsaW5lKSl9IGRlcGxveSAke3BpcGVsaW5lU3RhY2tJZGVudGlmaWVyfSAtLXJlcXVpcmUtYXBwcm92YWw9bmV2ZXIgLS12ZXJib3NlYCxcbiAgICAgIF0sXG5cbiAgICAgIHJvbGVQb2xpY3lTdGF0ZW1lbnRzOiBbXG4gICAgICAgIC8vIGFsbG93IHRoZSBzZWxmLW11dGF0aW5nIHByb2plY3QgcGVybWlzc2lvbnMgdG8gYXNzdW1lIHRoZSBib290c3RyYXAgQWN0aW9uIHJvbGVcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFsnc3RzOkFzc3VtZVJvbGUnXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFtgYXJuOio6aWFtOjoke1N0YWNrLm9mKHRoaXMucGlwZWxpbmUpLmFjY291bnR9OnJvbGUvKmBdLFxuICAgICAgICAgIGNvbmRpdGlvbnM6IHtcbiAgICAgICAgICAgICdGb3JBbnlWYWx1ZTpTdHJpbmdFcXVhbHMnOiB7XG4gICAgICAgICAgICAgICdpYW06UmVzb3VyY2VUYWcvYXdzLWNkazpib290c3RyYXAtcm9sZSc6IFsnaW1hZ2UtcHVibGlzaGluZycsICdmaWxlLXB1Ymxpc2hpbmcnLCAnZGVwbG95J10sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogWydjbG91ZGZvcm1hdGlvbjpEZXNjcmliZVN0YWNrcyddLFxuICAgICAgICAgIHJlc291cmNlczogWycqJ10sIC8vIHRoaXMgaXMgbmVlZGVkIHRvIGNoZWNrIHRoZSBzdGF0dXMgb2YgdGhlIGJvb3RzdHJhcCBzdGFjayB3aGVuIGRvaW5nIGBjZGsgZGVwbG95YFxuICAgICAgICB9KSxcbiAgICAgICAgLy8gUzMgY2hlY2tzIGZvciB0aGUgcHJlc2VuY2Ugb2YgdGhlIExpc3RCdWNrZXQgcGVybWlzc2lvblxuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogWydzMzpMaXN0QnVja2V0J10sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbJyonXSxcbiAgICAgICAgfSksXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgLy8gRGlmZmVyZW50IG9uIHB1cnBvc2UgLS0gaWQgbmVlZGVkIGZvciBiYWNrd2FyZHMgY29tcGF0aWJsZSBMb2dpY2FsSURcbiAgICByZXR1cm4gQ29kZUJ1aWxkRmFjdG9yeS5mcm9tQ29kZUJ1aWxkU3RlcCgnU2VsZk11dGF0aW9uJywgc3RlcCwge1xuICAgICAgYWRkaXRpb25hbENvbnN0cnVjdExldmVsOiBmYWxzZSxcbiAgICAgIHNjb3BlOiBvYnRhaW5TY29wZSh0aGlzLCAnVXBkYXRlUGlwZWxpbmUnKSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcHVibGlzaEFzc2V0c0FjdGlvbihub2RlOiBBR3JhcGhOb2RlLCBhc3NldHM6IFN0YWNrQXNzZXRbXSk6IElDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5IHtcbiAgICBjb25zdCBpbnN0YWxsU3VmZml4ID0gdGhpcy5jbGlWZXJzaW9uID8gYEAke3RoaXMuY2xpVmVyc2lvbn1gIDogJyc7XG5cbiAgICBjb25zdCBjb21tYW5kcyA9IGFzc2V0cy5tYXAoYXNzZXQgPT4ge1xuICAgICAgY29uc3QgcmVsYXRpdmVBc3NldE1hbmlmZXN0UGF0aCA9IHBhdGgucmVsYXRpdmUodGhpcy5teUN4QXNtUm9vdCwgYXNzZXQuYXNzZXRNYW5pZmVzdFBhdGgpO1xuICAgICAgcmV0dXJuIGBjZGstYXNzZXRzIC0tcGF0aCBcIiR7dG9Qb3NpeFBhdGgocmVsYXRpdmVBc3NldE1hbmlmZXN0UGF0aCl9XCIgLS12ZXJib3NlIHB1Ymxpc2ggXCIke2Fzc2V0LmFzc2V0U2VsZWN0b3J9XCJgO1xuICAgIH0pO1xuXG4gICAgY29uc3QgYXNzZXRUeXBlID0gYXNzZXRzWzBdLmFzc2V0VHlwZTtcbiAgICBpZiAoYXNzZXRzLnNvbWUoYSA9PiBhLmFzc2V0VHlwZSAhPT0gYXNzZXRUeXBlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBbGwgYXNzZXRzIGluIGEgc2luZ2xlIHB1Ymxpc2hpbmcgc3RlcCBtdXN0IGJlIG9mIHRoZSBzYW1lIHR5cGUnKTtcbiAgICB9XG5cbiAgICBjb25zdCBwdWJsaXNoaW5nUm9sZXMgPSB0aGlzLmFzc2V0UHVibGlzaGluZ1JvbGVzW2Fzc2V0VHlwZV0gPSAodGhpcy5hc3NldFB1Ymxpc2hpbmdSb2xlc1thc3NldFR5cGVdID8/IG5ldyBTZXQoKSk7XG4gICAgZm9yIChjb25zdCBhc3NldCBvZiBhc3NldHMpIHtcbiAgICAgIGlmIChhc3NldC5hc3NldFB1Ymxpc2hpbmdSb2xlQXJuKSB7XG4gICAgICAgIHB1Ymxpc2hpbmdSb2xlcy5hZGQoYXNzZXQuYXNzZXRQdWJsaXNoaW5nUm9sZUFybik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3Qgcm9sZSA9IHRoaXMub2J0YWluQXNzZXRDb2RlQnVpbGRSb2xlKGFzc2V0c1swXS5hc3NldFR5cGUpO1xuXG4gICAgLy8gVGhlIGJhc2UgY29tbWFuZHMgdGhhdCBuZWVkIHRvIGJlIHJ1blxuICAgIGNvbnN0IHNjcmlwdCA9IG5ldyBDb2RlQnVpbGRTdGVwKG5vZGUuaWQsIHtcbiAgICAgIGNvbW1hbmRzLFxuICAgICAgaW5zdGFsbENvbW1hbmRzOiBbXG4gICAgICAgIGBucG0gaW5zdGFsbCAtZyBjZGstYXNzZXRzJHtpbnN0YWxsU3VmZml4fWAsXG4gICAgICBdLFxuICAgICAgaW5wdXQ6IHRoaXMuX2Nsb3VkQXNzZW1ibHlGaWxlU2V0LFxuICAgICAgYnVpbGRFbnZpcm9ubWVudDoge1xuICAgICAgICBwcml2aWxlZ2VkOiBhc3NldHMuc29tZShhc3NldCA9PiBhc3NldC5hc3NldFR5cGUgPT09IEFzc2V0VHlwZS5ET0NLRVJfSU1BR0UpLFxuICAgICAgfSxcbiAgICAgIHJvbGUsXG4gICAgfSk7XG5cbiAgICAvLyBDdXN0b21pemF0aW9ucyB0aGF0IGFyZSBub3QgYWNjZXNzaWJsZSB0byByZWd1bGFyIHVzZXJzXG4gICAgcmV0dXJuIENvZGVCdWlsZEZhY3RvcnkuZnJvbUNvZGVCdWlsZFN0ZXAobm9kZS5pZCwgc2NyaXB0LCB7XG4gICAgICBhZGRpdGlvbmFsQ29uc3RydWN0TGV2ZWw6IGZhbHNlLFxuXG4gICAgICAvLyBJZiB3ZSB1c2UgYSBzaW5nbGUgcHVibGlzaGVyLCBwYXNzIGJ1aWxkc3BlYyB2aWEgZmlsZSBvdGhlcndpc2UgaXQnbGxcbiAgICAgIC8vIGdyb3cgdG9vIGJpZy5cbiAgICAgIHBhc3NCdWlsZFNwZWNWaWFDbG91ZEFzc2VtYmx5OiB0aGlzLnNpbmdsZVB1Ymxpc2hlclBlckFzc2V0VHlwZSxcbiAgICAgIHNjb3BlOiB0aGlzLmFzc2V0c1Njb3BlLFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBub2RlVHlwZUZyb21Ob2RlKG5vZGU6IEFHcmFwaE5vZGUpIHtcbiAgICBpZiAobm9kZS5kYXRhPy50eXBlID09PSAnc3RlcCcpIHtcbiAgICAgIHJldHVybiAhIW5vZGUuZGF0YT8uaXNCdWlsZFN0ZXAgPyBDb2RlQnVpbGRQcm9qZWN0VHlwZS5TWU5USCA6IENvZGVCdWlsZFByb2plY3RUeXBlLlNURVA7XG4gICAgfVxuICAgIGlmIChub2RlLmRhdGE/LnR5cGUgPT09ICdwdWJsaXNoLWFzc2V0cycpIHtcbiAgICAgIHJldHVybiBDb2RlQnVpbGRQcm9qZWN0VHlwZS5BU1NFVFM7XG4gICAgfVxuICAgIGlmIChub2RlLmRhdGE/LnR5cGUgPT09ICdzZWxmLXVwZGF0ZScpIHtcbiAgICAgIHJldHVybiBDb2RlQnVpbGRQcm9qZWN0VHlwZS5TRUxGX01VVEFURTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIHByaXZhdGUgY29kZUJ1aWxkRGVmYXVsdHNGb3Iobm9kZVR5cGU6IENvZGVCdWlsZFByb2plY3RUeXBlKTogQ29kZUJ1aWxkT3B0aW9ucyB8IHVuZGVmaW5lZCB7XG4gICAgY29uc3QgZGVmYXVsdE9wdGlvbnM6IENvZGVCdWlsZE9wdGlvbnMgPSB7XG4gICAgICBidWlsZEVudmlyb25tZW50OiB7XG4gICAgICAgIGJ1aWxkSW1hZ2U6IGNiLkxpbnV4QnVpbGRJbWFnZS5TVEFOREFSRF81XzAsXG4gICAgICAgIGNvbXB1dGVUeXBlOiBjYi5Db21wdXRlVHlwZS5TTUFMTCxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIGNvbnN0IHR5cGVCYXNlZEN1c3RvbWl6YXRpb25zID0ge1xuICAgICAgW0NvZGVCdWlsZFByb2plY3RUeXBlLlNZTlRIXTogdGhpcy5wcm9wcy5kb2NrZXJFbmFibGVkRm9yU3ludGhcbiAgICAgICAgPyBtZXJnZUNvZGVCdWlsZE9wdGlvbnModGhpcy5wcm9wcy5zeW50aENvZGVCdWlsZERlZmF1bHRzLCB7IGJ1aWxkRW52aXJvbm1lbnQ6IHsgcHJpdmlsZWdlZDogdHJ1ZSB9IH0pXG4gICAgICAgIDogdGhpcy5wcm9wcy5zeW50aENvZGVCdWlsZERlZmF1bHRzLFxuXG4gICAgICBbQ29kZUJ1aWxkUHJvamVjdFR5cGUuQVNTRVRTXTogdGhpcy5wcm9wcy5hc3NldFB1Ymxpc2hpbmdDb2RlQnVpbGREZWZhdWx0cyxcblxuICAgICAgW0NvZGVCdWlsZFByb2plY3RUeXBlLlNFTEZfTVVUQVRFXTogdGhpcy5wcm9wcy5kb2NrZXJFbmFibGVkRm9yU2VsZk11dGF0aW9uXG4gICAgICAgID8gbWVyZ2VDb2RlQnVpbGRPcHRpb25zKHRoaXMucHJvcHMuc2VsZk11dGF0aW9uQ29kZUJ1aWxkRGVmYXVsdHMsIHsgYnVpbGRFbnZpcm9ubWVudDogeyBwcml2aWxlZ2VkOiB0cnVlIH0gfSlcbiAgICAgICAgOiB0aGlzLnByb3BzLnNlbGZNdXRhdGlvbkNvZGVCdWlsZERlZmF1bHRzLFxuXG4gICAgICBbQ29kZUJ1aWxkUHJvamVjdFR5cGUuU1RFUF06IHt9LFxuICAgIH07XG5cbiAgICBjb25zdCBkb2NrZXJVc2FnZSA9IGRvY2tlclVzYWdlRnJvbUNvZGVCdWlsZChub2RlVHlwZSk7XG4gICAgY29uc3QgZG9ja2VyQ29tbWFuZHMgPSBkb2NrZXJVc2FnZSAhPT0gdW5kZWZpbmVkXG4gICAgICA/IGRvY2tlckNyZWRlbnRpYWxzSW5zdGFsbENvbW1hbmRzKGRvY2tlclVzYWdlLCB0aGlzLmRvY2tlckNyZWRlbnRpYWxzLCAnYm90aCcpXG4gICAgICA6IFtdO1xuICAgIGNvbnN0IHR5cGVCYXNlZERvY2tlckNvbW1hbmRzID0gZG9ja2VyQ29tbWFuZHMubGVuZ3RoID4gMCA/IHtcbiAgICAgIHBhcnRpYWxCdWlsZFNwZWM6IGNiLkJ1aWxkU3BlYy5mcm9tT2JqZWN0KHtcbiAgICAgICAgdmVyc2lvbjogJzAuMicsXG4gICAgICAgIHBoYXNlczoge1xuICAgICAgICAgIHByZV9idWlsZDoge1xuICAgICAgICAgICAgY29tbWFuZHM6IGRvY2tlckNvbW1hbmRzLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICB9IDoge307XG5cbiAgICByZXR1cm4gbWVyZ2VDb2RlQnVpbGRPcHRpb25zKFxuICAgICAgZGVmYXVsdE9wdGlvbnMsXG4gICAgICB0aGlzLnByb3BzLmNvZGVCdWlsZERlZmF1bHRzLFxuICAgICAgdHlwZUJhc2VkQ3VzdG9taXphdGlvbnNbbm9kZVR5cGVdLFxuICAgICAgdHlwZUJhc2VkRG9ja2VyQ29tbWFuZHMsXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgcm9sZUZyb21QbGFjZWhvbGRlckFybihzY29wZTogQ29uc3RydWN0LCByZWdpb246IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgICBhY2NvdW50OiBzdHJpbmcgfCB1bmRlZmluZWQsIGFybjogc3RyaW5nKTogaWFtLklSb2xlO1xuICBwcml2YXRlIHJvbGVGcm9tUGxhY2Vob2xkZXJBcm4oc2NvcGU6IENvbnN0cnVjdCwgcmVnaW9uOiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gICAgYWNjb3VudDogc3RyaW5nIHwgdW5kZWZpbmVkLCBhcm46IHN0cmluZyB8IHVuZGVmaW5lZCk6IGlhbS5JUm9sZSB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSByb2xlRnJvbVBsYWNlaG9sZGVyQXJuKHNjb3BlOiBDb25zdHJ1Y3QsIHJlZ2lvbjogc3RyaW5nIHwgdW5kZWZpbmVkLFxuICAgIGFjY291bnQ6IHN0cmluZyB8IHVuZGVmaW5lZCwgYXJuOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBpYW0uSVJvbGUgfCB1bmRlZmluZWQge1xuXG4gICAgaWYgKCFhcm4pIHsgcmV0dXJuIHVuZGVmaW5lZDsgfVxuXG4gICAgLy8gVXNlIHBsYWNlaG9sZGVyIGFybiBhcyBjb25zdHJ1Y3QgSUQuXG4gICAgY29uc3QgaWQgPSBhcm47XG5cbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYXdzL2F3cy1jZGsvaXNzdWVzLzcyNTVcbiAgICBsZXQgZXhpc3RpbmdSb2xlID0gTm9kZS5vZihzY29wZSkudHJ5RmluZENoaWxkKGBJbW11dGFibGVSb2xlJHtpZH1gKSBhcyBpYW0uSVJvbGU7XG4gICAgaWYgKGV4aXN0aW5nUm9sZSkgeyByZXR1cm4gZXhpc3RpbmdSb2xlOyB9XG4gICAgLy8gRm9yIHdoZW4gIzcyNTUgaXMgZml4ZWQuXG4gICAgZXhpc3RpbmdSb2xlID0gTm9kZS5vZihzY29wZSkudHJ5RmluZENoaWxkKGlkKSBhcyBpYW0uSVJvbGU7XG4gICAgaWYgKGV4aXN0aW5nUm9sZSkgeyByZXR1cm4gZXhpc3RpbmdSb2xlOyB9XG5cbiAgICBjb25zdCBhcm5Ub0ltcG9ydCA9IGN4YXBpLkVudmlyb25tZW50UGxhY2Vob2xkZXJzLnJlcGxhY2UoYXJuLCB7XG4gICAgICByZWdpb246IHJlZ2lvbiA/PyBBd3MuUkVHSU9OLFxuICAgICAgYWNjb3VudElkOiBhY2NvdW50ID8/IEF3cy5BQ0NPVU5UX0lELFxuICAgICAgcGFydGl0aW9uOiBBd3MuUEFSVElUSU9OLFxuICAgIH0pO1xuICAgIHJldHVybiBpYW0uUm9sZS5mcm9tUm9sZUFybihzY29wZSwgaWQsIGFyblRvSW1wb3J0LCB7IG11dGFibGU6IGZhbHNlLCBhZGRHcmFudHNUb1Jlc291cmNlczogdHJ1ZSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBOb24tdGVtcGxhdGUgY29uZmlnIGZpbGVzIGZvciBDb2RlUGlwZWxpbmUgYWN0aW9uc1xuICAgKlxuICAgKiBDdXJyZW50bHkgb25seSBzdXBwb3J0cyB0YWdzLlxuICAgKi9cbiAgcHJpdmF0ZSB3cml0ZVRlbXBsYXRlQ29uZmlndXJhdGlvbihzdGFjazogU3RhY2tEZXBsb3ltZW50KTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICBpZiAoT2JqZWN0LmtleXMoc3RhY2sudGFncykubGVuZ3RoID09PSAwKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cblxuICAgIGNvbnN0IGFic0NvbmZpZ1BhdGggPSBgJHtzdGFjay5hYnNvbHV0ZVRlbXBsYXRlUGF0aH0uY29uZmlnLmpzb25gO1xuICAgIGNvbnN0IHJlbGF0aXZlQ29uZmlnUGF0aCA9IHBhdGgucmVsYXRpdmUodGhpcy5teUN4QXNtUm9vdCwgYWJzQ29uZmlnUGF0aCk7XG5cbiAgICAvLyBXcml0ZSB0aGUgdGVtcGxhdGUgY29uZmlndXJhdGlvbiBmaWxlIChmb3IgcGFyYW1ldGVycyBpbnRvIENyZWF0ZUNoYW5nZVNldCBjYWxsIHRoYXRcbiAgICAvLyBjYW5ub3QgYmUgY29uZmlndXJlZCBhbnkgb3RoZXIgd2F5KS4gVGhleSBtdXN0IGNvbWUgZnJvbSBhIGZpbGUsIGFuZCB0aGVyZSdzIHVuZm9ydHVuYXRlbHlcbiAgICAvLyBubyBiZXR0ZXIgaG9vayB0byB3cml0ZSB0aGlzIGZpbGUgKGBjb25zdHJ1Y3Qub25TeW50aGVzaXplKClgIHdvdWxkIGhhdmUgYmVlbiB0aGUgcHJpbWUgY2FuZGlkYXRlXG4gICAgLy8gYnV0IHRoYXQgaXMgYmVpbmcgZGVwcmVjYXRlZC0tYW5kIERlcGxveUNka1N0YWNrQWN0aW9uIGlzbid0IGV2ZW4gYSBjb25zdHJ1Y3QpLlxuICAgIHdyaXRlVGVtcGxhdGVDb25maWd1cmF0aW9uKGFic0NvbmZpZ1BhdGgsIHtcbiAgICAgIFRhZ3M6IG5vVW5kZWZpbmVkKHN0YWNrLnRhZ3MpLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHJlbGF0aXZlQ29uZmlnUGF0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIHJvbGUgaXMgdXNlZCBieSBib3RoIHRoZSBDb2RlUGlwZWxpbmUgYnVpbGQgYWN0aW9uIGFuZCByZWxhdGVkIENvZGVCdWlsZCBwcm9qZWN0LiBDb25zb2xpZGF0aW5nIHRoZXNlIHR3b1xuICAgKiByb2xlcyBpbnRvIG9uZSwgYW5kIHJlLXVzaW5nIGFjcm9zcyBhbGwgYXNzZXRzLCBzYXZlcyBzaWduaWZpY2FudCBzaXplIG9mIHRoZSBmaW5hbCBzeW50aGVzaXplZCBvdXRwdXQuXG4gICAqIE1vZGVsZWQgYWZ0ZXIgdGhlIENvZGVQaXBlbGluZSByb2xlIGFuZCAnQ29kZVBpcGVsaW5lQWN0aW9uUm9sZScgcm9sZXMuXG4gICAqIEdlbmVyYXRlcyBvbmUgcm9sZSBwZXIgYXNzZXQgdHlwZSB0byBzZXBhcmF0ZSBmaWxlIGFuZCBEb2NrZXIvaW1hZ2UtYmFzZWQgcGVybWlzc2lvbnMuXG4gICAqL1xuICBwcml2YXRlIG9idGFpbkFzc2V0Q29kZUJ1aWxkUm9sZShhc3NldFR5cGU6IEFzc2V0VHlwZSk6IGlhbS5JUm9sZSB7XG4gICAgaWYgKHRoaXMuYXNzZXRDb2RlQnVpbGRSb2xlc1thc3NldFR5cGVdKSB7XG4gICAgICByZXR1cm4gdGhpcy5hc3NldENvZGVCdWlsZFJvbGVzW2Fzc2V0VHlwZV07XG4gICAgfVxuXG4gICAgY29uc3Qgc3RhY2sgPSBTdGFjay5vZih0aGlzKTtcblxuICAgIGNvbnN0IHJvbGVQcmVmaXggPSBhc3NldFR5cGUgPT09IEFzc2V0VHlwZS5ET0NLRVJfSU1BR0UgPyAnRG9ja2VyJyA6ICdGaWxlJztcbiAgICBjb25zdCBhc3NldFJvbGUgPSBuZXcgQXNzZXRTaW5nbGV0b25Sb2xlKHRoaXMuYXNzZXRzU2NvcGUsIGAke3JvbGVQcmVmaXh9Um9sZWAsIHtcbiAgICAgIHJvbGVOYW1lOiBQaHlzaWNhbE5hbWUuR0VORVJBVEVfSUZfTkVFREVELFxuICAgICAgYXNzdW1lZEJ5OiBuZXcgaWFtLkNvbXBvc2l0ZVByaW5jaXBhbChcbiAgICAgICAgbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdjb2RlYnVpbGQuYW1hem9uYXdzLmNvbScpLFxuICAgICAgICBuZXcgaWFtLkFjY291bnRQcmluY2lwYWwoc3RhY2suYWNjb3VudCksXG4gICAgICApLFxuICAgIH0pO1xuXG4gICAgLy8gUHVibGlzaGluZyByb2xlIGFjY2Vzc1xuICAgIC8vIFRoZSBBUk5zIGluY2x1ZGUgcmF3IEFXUyBwc2V1ZG8gcGFyYW1ldGVycyAoZS5nLiwgJHtBV1M6OlBhcnRpdGlvbn0pLCB3aGljaCBuZWVkIHRvIGJlIHN1YnN0aXR1dGVkLlxuICAgIC8vIExhenktZXZhbHVhdGVkIHNvIGFsbCBhc3NldCBwdWJsaXNoaW5nIHJvbGVzIGFyZSBpbmNsdWRlZC5cbiAgICBhc3NldFJvbGUuYWRkVG9Qb2xpY3kobmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgYWN0aW9uczogWydzdHM6QXNzdW1lUm9sZSddLFxuICAgICAgcmVzb3VyY2VzOiBMYXp5Lmxpc3QoeyBwcm9kdWNlOiAoKSA9PiBBcnJheS5mcm9tKHRoaXMuYXNzZXRQdWJsaXNoaW5nUm9sZXNbYXNzZXRUeXBlXSA/PyBbXSkubWFwKGFybiA9PiBGbi5zdWIoYXJuKSkgfSksXG4gICAgfSkpO1xuXG4gICAgLy8gR3JhbnQgcHVsbCBhY2Nlc3MgZm9yIGFueSBFQ1IgcmVnaXN0cmllcyBhbmQgc2VjcmV0cyB0aGF0IGV4aXN0XG4gICAgaWYgKGFzc2V0VHlwZSA9PT0gQXNzZXRUeXBlLkRPQ0tFUl9JTUFHRSkge1xuICAgICAgdGhpcy5kb2NrZXJDcmVkZW50aWFscy5mb3JFYWNoKHJlZyA9PiByZWcuZ3JhbnRSZWFkKGFzc2V0Um9sZSwgRG9ja2VyQ3JlZGVudGlhbFVzYWdlLkFTU0VUX1BVQkxJU0hJTkcpKTtcbiAgICB9XG5cbiAgICB0aGlzLmFzc2V0Q29kZUJ1aWxkUm9sZXNbYXNzZXRUeXBlXSA9IGFzc2V0Um9sZTtcbiAgICByZXR1cm4gYXNzZXRSb2xlO1xuICB9XG59XG5cbmZ1bmN0aW9uIGRvY2tlclVzYWdlRnJvbUNvZGVCdWlsZChjYnQ6IENvZGVCdWlsZFByb2plY3RUeXBlKTogRG9ja2VyQ3JlZGVudGlhbFVzYWdlIHwgdW5kZWZpbmVkIHtcbiAgc3dpdGNoIChjYnQpIHtcbiAgICBjYXNlIENvZGVCdWlsZFByb2plY3RUeXBlLkFTU0VUUzogcmV0dXJuIERvY2tlckNyZWRlbnRpYWxVc2FnZS5BU1NFVF9QVUJMSVNISU5HO1xuICAgIGNhc2UgQ29kZUJ1aWxkUHJvamVjdFR5cGUuU0VMRl9NVVRBVEU6IHJldHVybiBEb2NrZXJDcmVkZW50aWFsVXNhZ2UuU0VMRl9VUERBVEU7XG4gICAgY2FzZSBDb2RlQnVpbGRQcm9qZWN0VHlwZS5TWU5USDogcmV0dXJuIERvY2tlckNyZWRlbnRpYWxVc2FnZS5TWU5USDtcbiAgICBjYXNlIENvZGVCdWlsZFByb2plY3RUeXBlLlNURVA6IHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbn1cblxuZW51bSBDb2RlQnVpbGRQcm9qZWN0VHlwZSB7XG4gIFNZTlRIID0gJ1NZTlRIJyxcbiAgQVNTRVRTID0gJ0FTU0VUUycsXG4gIFNFTEZfTVVUQVRFID0gJ1NFTEZfTVVUQVRFJyxcbiAgU1RFUCA9ICdTVEVQJyxcbn1cblxuLyoqXG4gKiBUYWtlIGEgc2V0IG9mIHRyYW5jaGVzIGFuZCBzcGxpdCB0aGVtIHVwIGludG8gZ3JvdXBzIHNvXG4gKiB0aGF0IG5vIHNldCBvZiB0cmFuY2hlcyBoYXMgbW9yZSB0aGFuIG4gaXRlbXMgdG90YWxcbiAqL1xuZnVuY3Rpb24gY2h1bmtUcmFuY2hlczxBPihuOiBudW1iZXIsIHhzczogQVtdW10pOiBBW11bXVtdIHtcbiAgY29uc3QgcmV0OiBBW11bXVtdID0gW107XG5cbiAgd2hpbGUgKHhzcy5sZW5ndGggPiAwKSB7XG4gICAgY29uc3QgdHJhbmNoZXM6IEFbXVtdID0gW107XG4gICAgbGV0IGNvdW50ID0gMDtcblxuICAgIHdoaWxlICh4c3MubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgeHMgPSB4c3NbMF07XG4gICAgICBjb25zdCBzcGFjZVJlbWFpbmluZyA9IG4gLSBjb3VudDtcbiAgICAgIGlmICh4cy5sZW5ndGggPD0gc3BhY2VSZW1haW5pbmcpIHtcbiAgICAgICAgdHJhbmNoZXMucHVzaCh4cyk7XG4gICAgICAgIGNvdW50ICs9IHhzLmxlbmd0aDtcbiAgICAgICAgeHNzLnNoaWZ0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0cmFuY2hlcy5wdXNoKHhzLnNwbGljZSgwLCBzcGFjZVJlbWFpbmluZykpO1xuICAgICAgICBjb3VudCA9IG47XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldC5wdXNoKHRyYW5jaGVzKTtcbiAgfVxuXG5cbiAgcmV0dXJuIHJldDtcbn1cblxuZnVuY3Rpb24gaXNDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5KHg6IGFueSk6IHggaXMgSUNvZGVQaXBlbGluZUFjdGlvbkZhY3Rvcnkge1xuICByZXR1cm4gISEoeCBhcyBJQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSkucHJvZHVjZUFjdGlvbjtcbn1cbiJdfQ==
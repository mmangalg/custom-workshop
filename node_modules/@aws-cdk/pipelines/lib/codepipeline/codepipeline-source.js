"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.CodePipelineSource = void 0;
const jsiiDeprecationWarnings = require("../../.warnings.jsii.js");
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const cp_actions = require("@aws-cdk/aws-codepipeline-actions");
const core_1 = require("@aws-cdk/core");
const constructs_1 = require("constructs");
const blueprint_1 = require("../blueprint");
const outputs_1 = require("./private/outputs");
/**
 * Factory for CodePipeline source steps
 *
 * This class contains a number of factory methods for the different types
 * of sources that CodePipeline supports.
 */
class CodePipelineSource extends blueprint_1.Step {
    constructor() {
        super(...arguments);
        // tells `PipelineGraph` to hoist a "Source" step
        this.isSource = true;
    }
    /**
     * Returns a GitHub source, using OAuth tokens to authenticate with
     * GitHub and a separate webhook to detect changes. This is no longer
     * the recommended method. Please consider using `connection()`
     * instead.
     *
     * Pass in the owner and repository in a single string, like this:
     *
     * ```ts
     * pipelines.CodePipelineSource.gitHub('owner/repo', 'main');
     * ```
     *
     * Authentication will be done by a secret called `github-token` in AWS
     * Secrets Manager (unless specified otherwise).
     *
     * The token should have these permissions:
     *
     * * **repo** - to read the repository
     * * **admin:repo_hook** - if you plan to use webhooks (true by default)
     */
    static gitHub(repoString, branch, props = {}) {
        try {
            jsiiDeprecationWarnings._aws_cdk_pipelines_GitHubSourceOptions(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.gitHub);
            }
            throw error;
        }
        return new GitHubSource(repoString, branch, props);
    }
    /**
     * Returns an S3 source.
     *
     * @param bucket The bucket where the source code is located.
     * @param props The options, which include the key that identifies the source code file and
     * and how the pipeline should be triggered.
     *
     * @example
     * declare const bucket: s3.Bucket;
     * pipelines.CodePipelineSource.s3(bucket, 'path/to/file.zip');
     */
    static s3(bucket, objectKey, props = {}) {
        try {
            jsiiDeprecationWarnings._aws_cdk_pipelines_S3SourceOptions(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.s3);
            }
            throw error;
        }
        return new S3Source(bucket, objectKey, props);
    }
    /**
     * Returns an ECR source.
     *
     * @param repository The repository that will be watched for changes.
     * @param props The options, which include the image tag to be checked for changes.
     *
     * @example
     * declare const repository: ecr.IRepository;
     * pipelines.CodePipelineSource.ecr(repository, {
     *   imageTag: 'latest',
     * });
     */
    static ecr(repository, props = {}) {
        try {
            jsiiDeprecationWarnings._aws_cdk_pipelines_ECRSourceOptions(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.ecr);
            }
            throw error;
        }
        return new ECRSource(repository, props);
    }
    /**
     * Returns a CodeStar connection source. A CodeStar connection allows AWS CodePipeline to
     * access external resources, such as repositories in GitHub, GitHub Enterprise or
     * BitBucket.
     *
     * To use this method, you first need to create a CodeStar connection
     * using the AWS console. In the process, you may have to sign in to the external provider
     * -- GitHub, for example -- to authorize AWS to read and modify your repository.
     * Once you have done this, copy the connection ARN and use it to create the source.
     *
     * Example:
     *
     * ```ts
     * pipelines.CodePipelineSource.connection('owner/repo', 'main', {
     *   connectionArn: 'arn:aws:codestar-connections:us-east-1:222222222222:connection/7d2469ff-514a-4e4f-9003-5ca4a43cdc41', // Created using the AWS console
     * });
     * ```
     *
     * @param repoString A string that encodes owner and repository separated by a slash (e.g. 'owner/repo').
     * @param branch The branch to use.
     * @param props The source properties, including the connection ARN.
     *
     * @see https://docs.aws.amazon.com/dtconsole/latest/userguide/welcome-connections.html
     */
    static connection(repoString, branch, props) {
        try {
            jsiiDeprecationWarnings._aws_cdk_pipelines_ConnectionSourceOptions(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.connection);
            }
            throw error;
        }
        return new CodeStarConnectionSource(repoString, branch, props);
    }
    /**
     * Returns a CodeCommit source.
     *
     * @param repository The CodeCommit repository.
     * @param branch The branch to use.
     * @param props The source properties.
     *
     * @example
     * declare const repository: codecommit.IRepository;
     * pipelines.CodePipelineSource.codeCommit(repository, 'main');
     */
    static codeCommit(repository, branch, props = {}) {
        try {
            jsiiDeprecationWarnings._aws_cdk_pipelines_CodeCommitSourceOptions(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.codeCommit);
            }
            throw error;
        }
        return new CodeCommitSource(repository, branch, props);
    }
    produceAction(stage, options) {
        try {
            jsiiDeprecationWarnings._aws_cdk_pipelines_ProduceActionOptions(options);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.produceAction);
            }
            throw error;
        }
        const output = options.artifacts.toCodePipeline(this.primaryOutput);
        const action = this.getAction(output, options.actionName, options.runOrder, options.variablesNamespace);
        stage.addAction(action);
        return { runOrdersConsumed: 1 };
    }
    /**
     * Return an attribute of the current source revision
     *
     * These values can be passed into the environment variables of pipeline steps,
     * so your steps can access information about the source revision.
     *
     * Pipeline synth step has some source attributes predefined in the environment.
     * If these suffice, you don't need to use this method for the synth step.
     * @see https://docs.aws.amazon.com/codebuild/latest/userguide/build-env-ref-env-vars.html
     *
     * What attributes are available depends on the type of source. These attributes
     * are supported:
     *
     * - GitHub, CodeCommit, and CodeStarSourceConnection
     *   - `AuthorDate`
     *   - `BranchName`
     *   - `CommitId`
     *   - `CommitMessage`
     * - GitHub, CodeCommit and ECR
     *   - `RepositoryName`
     * - GitHub and CodeCommit
     *   - `CommitterDate`
     * - GitHub
     *   - `CommitUrl`
     * - CodeStarSourceConnection
     *   - `FullRepositoryName`
     * - S3
     *   - `ETag`
     *   - `VersionId`
     * - ECR
     *   - `ImageDigest`
     *   - `ImageTag`
     *   - `ImageURI`
     *   - `RegistryId`
     *
     * @see https://docs.aws.amazon.com/codepipeline/latest/userguide/reference-variables.html#reference-variables-list
     * @example
     * // Access the CommitId of a GitHub source in the synth
     * const source = pipelines.CodePipelineSource.gitHub('owner/repo', 'main');
     *
     * const pipeline = new pipelines.CodePipeline(scope, 'MyPipeline', {
     *   synth: new pipelines.ShellStep('Synth', {
     *     input: source,
     *     commands: [],
     *     env: {
     *       'COMMIT_ID': source.sourceAttribute('CommitId'),
     *     }
     *   })
     * });
     */
    sourceAttribute(name) {
        return outputs_1.makeCodePipelineOutput(this, name);
    }
}
exports.CodePipelineSource = CodePipelineSource;
_a = JSII_RTTI_SYMBOL_1;
CodePipelineSource[_a] = { fqn: "@aws-cdk/pipelines.CodePipelineSource", version: "1.153.1" };
/**
 * Extend CodePipelineSource so we can type-test in the CodePipelineEngine.
 */
class GitHubSource extends CodePipelineSource {
    constructor(repoString, branch, props) {
        var _b;
        super(repoString);
        this.branch = branch;
        this.props = props;
        const parts = repoString.split('/');
        if (core_1.Token.isUnresolved(repoString) || parts.length !== 2) {
            throw new Error(`GitHub repository name should be a resolved string like '<owner>/<repo>', got '${repoString}'`);
        }
        this.owner = parts[0];
        this.repo = parts[1];
        this.authentication = (_b = props.authentication) !== null && _b !== void 0 ? _b : core_1.SecretValue.secretsManager('github-token');
        this.configurePrimaryOutput(new blueprint_1.FileSet('Source', this));
    }
    getAction(output, actionName, runOrder, variablesNamespace) {
        return new cp_actions.GitHubSourceAction({
            output,
            actionName,
            runOrder,
            oauthToken: this.authentication,
            owner: this.owner,
            repo: this.repo,
            branch: this.branch,
            trigger: this.props.trigger,
            variablesNamespace,
        });
    }
}
class S3Source extends CodePipelineSource {
    constructor(bucket, objectKey, props) {
        super(constructs_1.Node.of(bucket).addr);
        this.bucket = bucket;
        this.objectKey = objectKey;
        this.props = props;
        this.configurePrimaryOutput(new blueprint_1.FileSet('Source', this));
    }
    getAction(output, _actionName, runOrder, variablesNamespace) {
        var _b;
        return new cp_actions.S3SourceAction({
            output,
            // Bucket names are guaranteed to conform to ActionName restrictions
            actionName: (_b = this.props.actionName) !== null && _b !== void 0 ? _b : this.bucket.bucketName,
            runOrder,
            bucketKey: this.objectKey,
            trigger: this.props.trigger,
            bucket: this.bucket,
            variablesNamespace,
        });
    }
}
class ECRSource extends CodePipelineSource {
    constructor(repository, props) {
        super(constructs_1.Node.of(repository).addr);
        this.repository = repository;
        this.props = props;
        this.configurePrimaryOutput(new blueprint_1.FileSet('Source', this));
    }
    getAction(output, _actionName, runOrder, variablesNamespace) {
        var _b;
        // RepositoryName can contain '/' that is not a valid ActionName character, use '_' instead
        const formattedRepositoryName = core_1.Fn.join('_', core_1.Fn.split('/', this.repository.repositoryName));
        return new cp_actions.EcrSourceAction({
            output,
            actionName: (_b = this.props.actionName) !== null && _b !== void 0 ? _b : formattedRepositoryName,
            runOrder,
            repository: this.repository,
            imageTag: this.props.imageTag,
            variablesNamespace,
        });
    }
}
class CodeStarConnectionSource extends CodePipelineSource {
    constructor(repoString, branch, props) {
        super(repoString);
        this.branch = branch;
        this.props = props;
        const parts = repoString.split('/');
        if (core_1.Token.isUnresolved(repoString) || parts.length !== 2) {
            throw new Error(`CodeStar repository name should be a resolved string like '<owner>/<repo>', got '${repoString}'`);
        }
        this.owner = parts[0];
        this.repo = parts[1];
        this.configurePrimaryOutput(new blueprint_1.FileSet('Source', this));
    }
    getAction(output, actionName, runOrder, variablesNamespace) {
        return new cp_actions.CodeStarConnectionsSourceAction({
            output,
            actionName,
            runOrder,
            connectionArn: this.props.connectionArn,
            owner: this.owner,
            repo: this.repo,
            branch: this.branch,
            codeBuildCloneOutput: this.props.codeBuildCloneOutput,
            triggerOnPush: this.props.triggerOnPush,
            variablesNamespace,
        });
    }
}
class CodeCommitSource extends CodePipelineSource {
    constructor(repository, branch, props) {
        super(core_1.Token.isUnresolved(repository.repositoryName)
            ? constructs_1.Node.of(repository).addr
            : repository.repositoryName);
        this.repository = repository;
        this.branch = branch;
        this.props = props;
        this.configurePrimaryOutput(new blueprint_1.FileSet('Source', this));
    }
    getAction(output, _actionName, runOrder, variablesNamespace) {
        return new cp_actions.CodeCommitSourceAction({
            output,
            // Guaranteed to be okay as action name
            actionName: this.repository.repositoryName,
            runOrder,
            branch: this.branch,
            trigger: this.props.trigger,
            repository: this.repository,
            eventRole: this.props.eventRole,
            codeBuildCloneOutput: this.props.codeBuildCloneOutput,
            variablesNamespace,
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZXBpcGVsaW5lLXNvdXJjZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNvZGVwaXBlbGluZS1zb3VyY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBR0EsZ0VBQWdFO0FBS2hFLHdDQUF1RDtBQUN2RCwyQ0FBa0M7QUFDbEMsNENBQTZDO0FBRTdDLCtDQUEyRDtBQUUzRDs7Ozs7R0FLRztBQUNILE1BQXNCLGtCQUFtQixTQUFRLGdCQUFJO0lBQXJEOztRQW1HRSxpREFBaUQ7UUFDakMsYUFBUSxHQUFHLElBQUksQ0FBQztLQWlFakM7SUFwS0M7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7T0FtQkc7SUFDSSxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQWtCLEVBQUUsTUFBYyxFQUFFLFFBQTZCLEVBQUU7Ozs7Ozs7Ozs7UUFDdEYsT0FBTyxJQUFJLFlBQVksQ0FBQyxVQUFVLEVBQUUsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDO0tBQ3BEO0lBRUQ7Ozs7Ozs7Ozs7T0FVRztJQUNJLE1BQU0sQ0FBQyxFQUFFLENBQUMsTUFBZSxFQUFFLFNBQWlCLEVBQUUsUUFBeUIsRUFBRTs7Ozs7Ozs7OztRQUM5RSxPQUFPLElBQUksUUFBUSxDQUFDLE1BQU0sRUFBRSxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUM7S0FDL0M7SUFFRDs7Ozs7Ozs7Ozs7T0FXRztJQUNJLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBdUIsRUFBRSxRQUEwQixFQUFFOzs7Ozs7Ozs7O1FBQ3JFLE9BQU8sSUFBSSxTQUFTLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDO0tBQ3pDO0lBRUQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O09BdUJHO0lBQ0ksTUFBTSxDQUFDLFVBQVUsQ0FBQyxVQUFrQixFQUFFLE1BQWMsRUFBRSxLQUE4Qjs7Ozs7Ozs7OztRQUN6RixPQUFPLElBQUksd0JBQXdCLENBQUMsVUFBVSxFQUFFLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztLQUNoRTtJ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Q0FBQyxvQkFBb0I7WUFDckQsa0JBQWtCO1NBQ25CLENBQUMsQ0FBQztLQUNKO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBjb2RlY29tbWl0IGZyb20gJ0Bhd3MtY2RrL2F3cy1jb2RlY29tbWl0JztcbmltcG9ydCAqIGFzIGNwIGZyb20gJ0Bhd3MtY2RrL2F3cy1jb2RlcGlwZWxpbmUnO1xuaW1wb3J0IHsgQXJ0aWZhY3QgfSBmcm9tICdAYXdzLWNkay9hd3MtY29kZXBpcGVsaW5lJztcbmltcG9ydCAqIGFzIGNwX2FjdGlvbnMgZnJvbSAnQGF3cy1jZGsvYXdzLWNvZGVwaXBlbGluZS1hY3Rpb25zJztcbmltcG9ydCB7IEFjdGlvbiwgQ29kZUNvbW1pdFRyaWdnZXIsIEdpdEh1YlRyaWdnZXIsIFMzVHJpZ2dlciB9IGZyb20gJ0Bhd3MtY2RrL2F3cy1jb2RlcGlwZWxpbmUtYWN0aW9ucyc7XG5pbXBvcnQgeyBJUmVwb3NpdG9yeSB9IGZyb20gJ0Bhd3MtY2RrL2F3cy1lY3InO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ0Bhd3MtY2RrL2F3cy1pYW0nO1xuaW1wb3J0IHsgSUJ1Y2tldCB9IGZyb20gJ0Bhd3MtY2RrL2F3cy1zMyc7XG5pbXBvcnQgeyBGbiwgU2VjcmV0VmFsdWUsIFRva2VuIH0gZnJvbSAnQGF3cy1jZGsvY29yZSc7XG5pbXBvcnQgeyBOb2RlIH0gZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQgeyBGaWxlU2V0LCBTdGVwIH0gZnJvbSAnLi4vYmx1ZXByaW50JztcbmltcG9ydCB7IENvZGVQaXBlbGluZUFjdGlvbkZhY3RvcnlSZXN1bHQsIFByb2R1Y2VBY3Rpb25PcHRpb25zLCBJQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSB9IGZyb20gJy4vY29kZXBpcGVsaW5lLWFjdGlvbi1mYWN0b3J5JztcbmltcG9ydCB7IG1ha2VDb2RlUGlwZWxpbmVPdXRwdXQgfSBmcm9tICcuL3ByaXZhdGUvb3V0cHV0cyc7XG5cbi8qKlxuICogRmFjdG9yeSBmb3IgQ29kZVBpcGVsaW5lIHNvdXJjZSBzdGVwc1xuICpcbiAqIFRoaXMgY2xhc3MgY29udGFpbnMgYSBudW1iZXIgb2YgZmFjdG9yeSBtZXRob2RzIGZvciB0aGUgZGlmZmVyZW50IHR5cGVzXG4gKiBvZiBzb3VyY2VzIHRoYXQgQ29kZVBpcGVsaW5lIHN1cHBvcnRzLlxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQ29kZVBpcGVsaW5lU291cmNlIGV4dGVuZHMgU3RlcCBpbXBsZW1lbnRzIElDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5IHtcbiAgLyoqXG4gICAqIFJldHVybnMgYSBHaXRIdWIgc291cmNlLCB1c2luZyBPQXV0aCB0b2tlbnMgdG8gYXV0aGVudGljYXRlIHdpdGhcbiAgICogR2l0SHViIGFuZCBhIHNlcGFyYXRlIHdlYmhvb2sgdG8gZGV0ZWN0IGNoYW5nZXMuIFRoaXMgaXMgbm8gbG9uZ2VyXG4gICAqIHRoZSByZWNvbW1lbmRlZCBtZXRob2QuIFBsZWFzZSBjb25zaWRlciB1c2luZyBgY29ubmVjdGlvbigpYFxuICAgKiBpbnN0ZWFkLlxuICAgKlxuICAgKiBQYXNzIGluIHRoZSBvd25lciBhbmQgcmVwb3NpdG9yeSBpbiBhIHNpbmdsZSBzdHJpbmcsIGxpa2UgdGhpczpcbiAgICpcbiAgICogYGBgdHNcbiAgICogcGlwZWxpbmVzLkNvZGVQaXBlbGluZVNvdXJjZS5naXRIdWIoJ293bmVyL3JlcG8nLCAnbWFpbicpO1xuICAgKiBgYGBcbiAgICpcbiAgICogQXV0aGVudGljYXRpb24gd2lsbCBiZSBkb25lIGJ5IGEgc2VjcmV0IGNhbGxlZCBgZ2l0aHViLXRva2VuYCBpbiBBV1NcbiAgICogU2VjcmV0cyBNYW5hZ2VyICh1bmxlc3Mgc3BlY2lmaWVkIG90aGVyd2lzZSkuXG4gICAqXG4gICAqIFRoZSB0b2tlbiBzaG91bGQgaGF2ZSB0aGVzZSBwZXJtaXNzaW9uczpcbiAgICpcbiAgICogKiAqKnJlcG8qKiAtIHRvIHJlYWQgdGhlIHJlcG9zaXRvcnlcbiAgICogKiAqKmFkbWluOnJlcG9faG9vayoqIC0gaWYgeW91IHBsYW4gdG8gdXNlIHdlYmhvb2tzICh0cnVlIGJ5IGRlZmF1bHQpXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGdpdEh1YihyZXBvU3RyaW5nOiBzdHJpbmcsIGJyYW5jaDogc3RyaW5nLCBwcm9wczogR2l0SHViU291cmNlT3B0aW9ucyA9IHt9KTogQ29kZVBpcGVsaW5lU291cmNlIHtcbiAgICByZXR1cm4gbmV3IEdpdEh1YlNvdXJjZShyZXBvU3RyaW5nLCBicmFuY2gsIHByb3BzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIFMzIHNvdXJjZS5cbiAgICpcbiAgICogQHBhcmFtIGJ1Y2tldCBUaGUgYnVja2V0IHdoZXJlIHRoZSBzb3VyY2UgY29kZSBpcyBsb2NhdGVkLlxuICAgKiBAcGFyYW0gcHJvcHMgVGhlIG9wdGlvbnMsIHdoaWNoIGluY2x1ZGUgdGhlIGtleSB0aGF0IGlkZW50aWZpZXMgdGhlIHNvdXJjZSBjb2RlIGZpbGUgYW5kXG4gICAqIGFuZCBob3cgdGhlIHBpcGVsaW5lIHNob3VsZCBiZSB0cmlnZ2VyZWQuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGRlY2xhcmUgY29uc3QgYnVja2V0OiBzMy5CdWNrZXQ7XG4gICAqIHBpcGVsaW5lcy5Db2RlUGlwZWxpbmVTb3VyY2UuczMoYnVja2V0LCAncGF0aC90by9maWxlLnppcCcpO1xuICAgKi9cbiAgcHVibGljIHN0YXRpYyBzMyhidWNrZXQ6IElCdWNrZXQsIG9iamVjdEtleTogc3RyaW5nLCBwcm9wczogUzNTb3VyY2VPcHRpb25zID0ge30pOiBDb2RlUGlwZWxpbmVTb3VyY2Uge1xuICAgIHJldHVybiBuZXcgUzNTb3VyY2UoYnVja2V0LCBvYmplY3RLZXksIHByb3BzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIEVDUiBzb3VyY2UuXG4gICAqXG4gICAqIEBwYXJhbSByZXBvc2l0b3J5IFRoZSByZXBvc2l0b3J5IHRoYXQgd2lsbCBiZSB3YXRjaGVkIGZvciBjaGFuZ2VzLlxuICAgKiBAcGFyYW0gcHJvcHMgVGhlIG9wdGlvbnMsIHdoaWNoIGluY2x1ZGUgdGhlIGltYWdlIHRhZyB0byBiZSBjaGVja2VkIGZvciBjaGFuZ2VzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBkZWNsYXJlIGNvbnN0IHJlcG9zaXRvcnk6IGVjci5JUmVwb3NpdG9yeTtcbiAgICogcGlwZWxpbmVzLkNvZGVQaXBlbGluZVNvdXJjZS5lY3IocmVwb3NpdG9yeSwge1xuICAgKiAgIGltYWdlVGFnOiAnbGF0ZXN0JyxcbiAgICogfSk7XG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGVjcihyZXBvc2l0b3J5OiBJUmVwb3NpdG9yeSwgcHJvcHM6IEVDUlNvdXJjZU9wdGlvbnMgPSB7fSk6IENvZGVQaXBlbGluZVNvdXJjZSB7XG4gICAgcmV0dXJuIG5ldyBFQ1JTb3VyY2UocmVwb3NpdG9yeSwgcHJvcHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBDb2RlU3RhciBjb25uZWN0aW9uIHNvdXJjZS4gQSBDb2RlU3RhciBjb25uZWN0aW9uIGFsbG93cyBBV1MgQ29kZVBpcGVsaW5lIHRvXG4gICAqIGFjY2VzcyBleHRlcm5hbCByZXNvdXJjZXMsIHN1Y2ggYXMgcmVwb3NpdG9yaWVzIGluIEdpdEh1YiwgR2l0SHViIEVudGVycHJpc2Ugb3JcbiAgICogQml0QnVja2V0LlxuICAgKlxuICAgKiBUbyB1c2UgdGhpcyBtZXRob2QsIHlvdSBmaXJzdCBuZWVkIHRvIGNyZWF0ZSBhIENvZGVTdGFyIGNvbm5lY3Rpb25cbiAgICogdXNpbmcgdGhlIEFXUyBjb25zb2xlLiBJbiB0aGUgcHJvY2VzcywgeW91IG1heSBoYXZlIHRvIHNpZ24gaW4gdG8gdGhlIGV4dGVybmFsIHByb3ZpZGVyXG4gICAqIC0tIEdpdEh1YiwgZm9yIGV4YW1wbGUgLS0gdG8gYXV0aG9yaXplIEFXUyB0byByZWFkIGFuZCBtb2RpZnkgeW91ciByZXBvc2l0b3J5LlxuICAgKiBPbmNlIHlvdSBoYXZlIGRvbmUgdGhpcywgY29weSB0aGUgY29ubmVjdGlvbiBBUk4gYW5kIHVzZSBpdCB0byBjcmVhdGUgdGhlIHNvdXJjZS5cbiAgICpcbiAgICogRXhhbXBsZTpcbiAgICpcbiAgICogYGBgdHNcbiAgICogcGlwZWxpbmVzLkNvZGVQaXBlbGluZVNvdXJjZS5jb25uZWN0aW9uKCdvd25lci9yZXBvJywgJ21haW4nLCB7XG4gICAqICAgY29ubmVjdGlvbkFybjogJ2Fybjphd3M6Y29kZXN0YXItY29ubmVjdGlvbnM6dXMtZWFzdC0xOjIyMjIyMjIyMjIyMjpjb25uZWN0aW9uLzdkMjQ2OWZmLTUxNGEtNGU0Zi05MDAzLTVjYTRhNDNjZGM0MScsIC8vIENyZWF0ZWQgdXNpbmcgdGhlIEFXUyBjb25zb2xlXG4gICAqIH0pO1xuICAgKiBgYGBcbiAgICpcbiAgICogQHBhcmFtIHJlcG9TdHJpbmcgQSBzdHJpbmcgdGhhdCBlbmNvZGVzIG93bmVyIGFuZCByZXBvc2l0b3J5IHNlcGFyYXRlZCBieSBhIHNsYXNoIChlLmcuICdvd25lci9yZXBvJykuXG4gICAqIEBwYXJhbSBicmFuY2ggVGhlIGJyYW5jaCB0byB1c2UuXG4gICAqIEBwYXJhbSBwcm9wcyBUaGUgc291cmNlIHByb3BlcnRpZXMsIGluY2x1ZGluZyB0aGUgY29ubmVjdGlvbiBBUk4uXG4gICAqXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2R0Y29uc29sZS9sYXRlc3QvdXNlcmd1aWRlL3dlbGNvbWUtY29ubmVjdGlvbnMuaHRtbFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBjb25uZWN0aW9uKHJlcG9TdHJpbmc6IHN0cmluZywgYnJhbmNoOiBzdHJpbmcsIHByb3BzOiBDb25uZWN0aW9uU291cmNlT3B0aW9ucyk6IENvZGVQaXBlbGluZVNvdXJjZSB7XG4gICAgcmV0dXJuIG5ldyBDb2RlU3RhckNvbm5lY3Rpb25Tb3VyY2UocmVwb1N0cmluZywgYnJhbmNoLCBwcm9wcyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIENvZGVDb21taXQgc291cmNlLlxuICAgKlxuICAgKiBAcGFyYW0gcmVwb3NpdG9yeSBUaGUgQ29kZUNvbW1pdCByZXBvc2l0b3J5LlxuICAgKiBAcGFyYW0gYnJhbmNoIFRoZSBicmFuY2ggdG8gdXNlLlxuICAgKiBAcGFyYW0gcHJvcHMgVGhlIHNvdXJjZSBwcm9wZXJ0aWVzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBkZWNsYXJlIGNvbnN0IHJlcG9zaXRvcnk6IGNvZGVjb21taXQuSVJlcG9zaXRvcnk7XG4gICAqIHBpcGVsaW5lcy5Db2RlUGlwZWxpbmVTb3VyY2UuY29kZUNvbW1pdChyZXBvc2l0b3J5LCAnbWFpbicpO1xuICAgKi9cbiAgcHVibGljIHN0YXRpYyBjb2RlQ29tbWl0KHJlcG9zaXRvcnk6IGNvZGVjb21taXQuSVJlcG9zaXRvcnksIGJyYW5jaDogc3RyaW5nLCBwcm9wczogQ29kZUNvbW1pdFNvdXJjZU9wdGlvbnMgPSB7fSk6IENvZGVQaXBlbGluZVNvdXJjZSB7XG4gICAgcmV0dXJuIG5ldyBDb2RlQ29tbWl0U291cmNlKHJlcG9zaXRvcnksIGJyYW5jaCwgcHJvcHMpO1xuICB9XG5cbiAgLy8gdGVsbHMgYFBpcGVsaW5lR3JhcGhgIHRvIGhvaXN0IGEgXCJTb3VyY2VcIiBzdGVwXG4gIHB1YmxpYyByZWFkb25seSBpc1NvdXJjZSA9IHRydWU7XG5cbiAgcHVibGljIHByb2R1Y2VBY3Rpb24oc3RhZ2U6IGNwLklTdGFnZSwgb3B0aW9uczogUHJvZHVjZUFjdGlvbk9wdGlvbnMpOiBDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5UmVzdWx0IHtcbiAgICBjb25zdCBvdXRwdXQgPSBvcHRpb25zLmFydGlmYWN0cy50b0NvZGVQaXBlbGluZSh0aGlzLnByaW1hcnlPdXRwdXQhKTtcblxuICAgIGNvbnN0IGFjdGlvbiA9IHRoaXMuZ2V0QWN0aW9uKG91dHB1dCwgb3B0aW9ucy5hY3Rpb25OYW1lLCBvcHRpb25zLnJ1bk9yZGVyLCBvcHRpb25zLnZhcmlhYmxlc05hbWVzcGFjZSk7XG4gICAgc3RhZ2UuYWRkQWN0aW9uKGFjdGlvbik7XG4gICAgcmV0dXJuIHsgcnVuT3JkZXJzQ29uc3VtZWQ6IDEgfTtcbiAgfVxuXG4gIHByb3RlY3RlZCBhYnN0cmFjdCBnZXRBY3Rpb24ob3V0cHV0OiBBcnRpZmFjdCwgYWN0aW9uTmFtZTogc3RyaW5nLCBydW5PcmRlcjogbnVtYmVyLCB2YXJpYWJsZXNOYW1lc3BhY2U/OiBzdHJpbmcpOiBBY3Rpb247XG5cbiAgLyoqXG4gICAqIFJldHVybiBhbiBhdHRyaWJ1dGUgb2YgdGhlIGN1cnJlbnQgc291cmNlIHJldmlzaW9uXG4gICAqXG4gICAqIFRoZXNlIHZhbHVlcyBjYW4gYmUgcGFzc2VkIGludG8gdGhlIGVudmlyb25tZW50IHZhcmlhYmxlcyBvZiBwaXBlbGluZSBzdGVwcyxcbiAgICogc28geW91ciBzdGVwcyBjYW4gYWNjZXNzIGluZm9ybWF0aW9uIGFib3V0IHRoZSBzb3VyY2UgcmV2aXNpb24uXG4gICAqXG4gICAqIFBpcGVsaW5lIHN5bnRoIHN0ZXAgaGFzIHNvbWUgc291cmNlIGF0dHJpYnV0ZXMgcHJlZGVmaW5lZCBpbiB0aGUgZW52aXJvbm1lbnQuXG4gICAqIElmIHRoZXNlIHN1ZmZpY2UsIHlvdSBkb24ndCBuZWVkIHRvIHVzZSB0aGlzIG1ldGhvZCBmb3IgdGhlIHN5bnRoIHN0ZXAuXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2NvZGVidWlsZC9sYXRlc3QvdXNlcmd1aWRlL2J1aWxkLWVudi1yZWYtZW52LXZhcnMuaHRtbFxuICAgKlxuICAgKiBXaGF0IGF0dHJpYnV0ZXMgYXJlIGF2YWlsYWJsZSBkZXBlbmRzIG9uIHRoZSB0eXBlIG9mIHNvdXJjZS4gVGhlc2UgYXR0cmlidXRlc1xuICAgKiBhcmUgc3VwcG9ydGVkOlxuICAgKlxuICAgKiAtIEdpdEh1YiwgQ29kZUNvbW1pdCwgYW5kIENvZGVTdGFyU291cmNlQ29ubmVjdGlvblxuICAgKiAgIC0gYEF1dGhvckRhdGVgXG4gICAqICAgLSBgQnJhbmNoTmFtZWBcbiAgICogICAtIGBDb21taXRJZGBcbiAgICogICAtIGBDb21taXRNZXNzYWdlYFxuICAgKiAtIEdpdEh1YiwgQ29kZUNvbW1pdCBhbmQgRUNSXG4gICAqICAgLSBgUmVwb3NpdG9yeU5hbWVgXG4gICAqIC0gR2l0SHViIGFuZCBDb2RlQ29tbWl0XG4gICAqICAgLSBgQ29tbWl0dGVyRGF0ZWBcbiAgICogLSBHaXRIdWJcbiAgICogICAtIGBDb21taXRVcmxgXG4gICAqIC0gQ29kZVN0YXJTb3VyY2VDb25uZWN0aW9uXG4gICAqICAgLSBgRnVsbFJlcG9zaXRvcnlOYW1lYFxuICAgKiAtIFMzXG4gICAqICAgLSBgRVRhZ2BcbiAgICogICAtIGBWZXJzaW9uSWRgXG4gICAqIC0gRUNSXG4gICAqICAgLSBgSW1hZ2VEaWdlc3RgXG4gICAqICAgLSBgSW1hZ2VUYWdgXG4gICAqICAgLSBgSW1hZ2VVUklgXG4gICAqICAgLSBgUmVnaXN0cnlJZGBcbiAgICpcbiAgICogQHNlZSBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vY29kZXBpcGVsaW5lL2xhdGVzdC91c2VyZ3VpZGUvcmVmZXJlbmNlLXZhcmlhYmxlcy5odG1sI3JlZmVyZW5jZS12YXJpYWJsZXMtbGlzdFxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBBY2Nlc3MgdGhlIENvbW1pdElkIG9mIGEgR2l0SHViIHNvdXJjZSBpbiB0aGUgc3ludGhcbiAgICogY29uc3Qgc291cmNlID0gcGlwZWxpbmVzLkNvZGVQaXBlbGluZVNvdXJjZS5naXRIdWIoJ293bmVyL3JlcG8nLCAnbWFpbicpO1xuICAgKlxuICAgKiBjb25zdCBwaXBlbGluZSA9IG5ldyBwaXBlbGluZXMuQ29kZVBpcGVsaW5lKHNjb3BlLCAnTXlQaXBlbGluZScsIHtcbiAgICogICBzeW50aDogbmV3IHBpcGVsaW5lcy5TaGVsbFN0ZXAoJ1N5bnRoJywge1xuICAgKiAgICAgaW5wdXQ6IHNvdXJjZSxcbiAgICogICAgIGNvbW1hbmRzOiBbXSxcbiAgICogICAgIGVudjoge1xuICAgKiAgICAgICAnQ09NTUlUX0lEJzogc291cmNlLnNvdXJjZUF0dHJpYnV0ZSgnQ29tbWl0SWQnKSxcbiAgICogICAgIH1cbiAgICogICB9KVxuICAgKiB9KTtcbiAgICovXG4gIHB1YmxpYyBzb3VyY2VBdHRyaWJ1dGUobmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gbWFrZUNvZGVQaXBlbGluZU91dHB1dCh0aGlzLCBuYW1lKTtcbiAgfVxufVxuXG4vKipcbiAqIE9wdGlvbnMgZm9yIEdpdEh1YiBzb3VyY2VzXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgR2l0SHViU291cmNlT3B0aW9ucyB7XG4gIC8qKlxuICAgKiBBIEdpdEh1YiBPQXV0aCB0b2tlbiB0byB1c2UgZm9yIGF1dGhlbnRpY2F0aW9uLlxuICAgKlxuICAgKiBJdCBpcyByZWNvbW1lbmRlZCB0byB1c2UgYSBTZWNyZXRzIE1hbmFnZXIgYFNlY3JldGAgdG8gb2J0YWluIHRoZSB0b2tlbjpcbiAgICpcbiAgICogYGBgdHNcbiAgICogY29uc3Qgb2F1dGggPSBjZGsuU2VjcmV0VmFsdWUuc2VjcmV0c01hbmFnZXIoJ215LWdpdGh1Yi10b2tlbicpO1xuICAgKiBgYGBcbiAgICpcbiAgICogVGhlIEdpdEh1YiBQZXJzb25hbCBBY2Nlc3MgVG9rZW4gc2hvdWxkIGhhdmUgdGhlc2Ugc2NvcGVzOlxuICAgKlxuICAgKiAqICoqcmVwbyoqIC0gdG8gcmVhZCB0aGUgcmVwb3NpdG9yeVxuICAgKiAqICoqYWRtaW46cmVwb19ob29rKiogLSBpZiB5b3UgcGxhbiB0byB1c2Ugd2ViaG9va3MgKHRydWUgYnkgZGVmYXVsdClcbiAgICpcbiAgICogQHNlZSBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vY29kZXBpcGVsaW5lL2xhdGVzdC91c2VyZ3VpZGUvR2l0SHViLWNyZWF0ZS1wZXJzb25hbC10b2tlbi1DTEkuaHRtbFxuICAgKlxuICAgKiBAZGVmYXVsdCAtIFNlY3JldFZhbHVlLnNlY3JldHNNYW5hZ2VyKCdnaXRodWItdG9rZW4nKVxuICAgKi9cbiAgcmVhZG9ubHkgYXV0aGVudGljYXRpb24/OiBTZWNyZXRWYWx1ZTtcblxuICAvKipcbiAgICogSG93IEFXUyBDb2RlUGlwZWxpbmUgc2hvdWxkIGJlIHRyaWdnZXJlZFxuICAgKlxuICAgKiBXaXRoIHRoZSBkZWZhdWx0IHZhbHVlIFwiV0VCSE9PS1wiLCBhIHdlYmhvb2sgaXMgY3JlYXRlZCBpbiBHaXRIdWIgdGhhdCB0cmlnZ2VycyB0aGUgYWN0aW9uLlxuICAgKiBXaXRoIFwiUE9MTFwiLCBDb2RlUGlwZWxpbmUgcGVyaW9kaWNhbGx5IGNoZWNrcyB0aGUgc291cmNlIGZvciBjaGFuZ2VzLlxuICAgKiBXaXRoIFwiTm9uZVwiLCB0aGUgYWN0aW9uIGlzIG5vdCB0cmlnZ2VyZWQgdGhyb3VnaCBjaGFuZ2VzIGluIHRoZSBzb3VyY2UuXG4gICAqXG4gICAqIFRvIHVzZSBgV0VCSE9PS2AsIHlvdXIgR2l0SHViIFBlcnNvbmFsIEFjY2VzcyBUb2tlbiBzaG91bGQgaGF2ZVxuICAgKiAqKmFkbWluOnJlcG9faG9vayoqIHNjb3BlIChpbiBhZGRpdGlvbiB0byB0aGUgcmVndWxhciAqKnJlcG8qKiBzY29wZSkuXG4gICAqXG4gICAqIEBkZWZhdWx0IEdpdEh1YlRyaWdnZXIuV0VCSE9PS1xuICAgKi9cbiAgcmVhZG9ubHkgdHJpZ2dlcj86IEdpdEh1YlRyaWdnZXI7XG5cbn1cblxuLyoqXG4gKiBFeHRlbmQgQ29kZVBpcGVsaW5lU291cmNlIHNvIHdlIGNhbiB0eXBlLXRlc3QgaW4gdGhlIENvZGVQaXBlbGluZUVuZ2luZS5cbiAqL1xuY2xhc3MgR2l0SHViU291cmNlIGV4dGVuZHMgQ29kZVBpcGVsaW5lU291cmNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBvd25lcjogc3RyaW5nO1xuICBwcml2YXRlIHJlYWRvbmx5IHJlcG86IHN0cmluZztcbiAgcHJpdmF0ZSByZWFkb25seSBhdXRoZW50aWNhdGlvbjogU2VjcmV0VmFsdWU7XG5cbiAgY29uc3RydWN0b3IocmVwb1N0cmluZzogc3RyaW5nLCByZWFkb25seSBicmFuY2g6IHN0cmluZywgcmVhZG9ubHkgcHJvcHM6IEdpdEh1YlNvdXJjZU9wdGlvbnMpIHtcbiAgICBzdXBlcihyZXBvU3RyaW5nKTtcblxuICAgIGNvbnN0IHBhcnRzID0gcmVwb1N0cmluZy5zcGxpdCgnLycpO1xuICAgIGlmIChUb2tlbi5pc1VucmVzb2x2ZWQocmVwb1N0cmluZykgfHwgcGFydHMubGVuZ3RoICE9PSAyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEdpdEh1YiByZXBvc2l0b3J5IG5hbWUgc2hvdWxkIGJlIGEgcmVzb2x2ZWQgc3RyaW5nIGxpa2UgJzxvd25lcj4vPHJlcG8+JywgZ290ICcke3JlcG9TdHJpbmd9J2ApO1xuICAgIH1cbiAgICB0aGlzLm93bmVyID0gcGFydHNbMF07XG4gICAgdGhpcy5yZXBvID0gcGFydHNbMV07XG4gICAgdGhpcy5hdXRoZW50aWNhdGlvbiA9IHByb3BzLmF1dGhlbnRpY2F0aW9uID8/IFNlY3JldFZhbHVlLnNlY3JldHNNYW5hZ2VyKCdnaXRodWItdG9rZW4nKTtcbiAgICB0aGlzLmNvbmZpZ3VyZVByaW1hcnlPdXRwdXQobmV3IEZpbGVTZXQoJ1NvdXJjZScsIHRoaXMpKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRBY3Rpb24ob3V0cHV0OiBBcnRpZmFjdCwgYWN0aW9uTmFtZTogc3RyaW5nLCBydW5PcmRlcjogbnVtYmVyLCB2YXJpYWJsZXNOYW1lc3BhY2U/OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gbmV3IGNwX2FjdGlvbnMuR2l0SHViU291cmNlQWN0aW9uKHtcbiAgICAgIG91dHB1dCxcbiAgICAgIGFjdGlvbk5hbWUsXG4gICAgICBydW5PcmRlcixcbiAgICAgIG9hdXRoVG9rZW46IHRoaXMuYXV0aGVudGljYXRpb24sXG4gICAgICBvd25lcjogdGhpcy5vd25lcixcbiAgICAgIHJlcG86IHRoaXMucmVwbyxcbiAgICAgIGJyYW5jaDogdGhpcy5icmFuY2gsXG4gICAgICB0cmlnZ2VyOiB0aGlzLnByb3BzLnRyaWdnZXIsXG4gICAgICB2YXJpYWJsZXNOYW1lc3BhY2UsXG4gICAgfSk7XG4gIH1cbn1cblxuLyoqXG4gKiBPcHRpb25zIGZvciBTMyBzb3VyY2VzXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUzNTb3VyY2VPcHRpb25zIHtcbiAgLyoqXG4gICAqIEhvdyBzaG91bGQgQ29kZVBpcGVsaW5lIGRldGVjdCBzb3VyY2UgY2hhbmdlcyBmb3IgdGhpcyBBY3Rpb24uXG4gICAqIE5vdGUgdGhhdCBpZiB0aGlzIGlzIFMzVHJpZ2dlci5FVkVOVFMsIHlvdSBuZWVkIHRvIG1ha2Ugc3VyZSB0byBpbmNsdWRlIHRoZSBzb3VyY2UgQnVja2V0IGluIGEgQ2xvdWRUcmFpbCBUcmFpbCxcbiAgICogYXMgb3RoZXJ3aXNlIHRoZSBDbG91ZFdhdGNoIEV2ZW50cyB3aWxsIG5vdCBiZSBlbWl0dGVkLlxuICAgKlxuICAgKiBAZGVmYXVsdCBTM1RyaWdnZXIuUE9MTFxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9BbWF6b25DbG91ZFdhdGNoL2xhdGVzdC9ldmVudHMvbG9nLXMzLWRhdGEtZXZlbnRzLmh0bWxcbiAgICovXG4gIHJlYWRvbmx5IHRyaWdnZXI/OiBTM1RyaWdnZXI7XG5cbiAgLyoqXG4gICAqIFRoZSBhY3Rpb24gbmFtZSB1c2VkIGZvciB0aGlzIHNvdXJjZSBpbiB0aGUgQ29kZVBpcGVsaW5lXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gVGhlIGJ1Y2tldCBuYW1lXG4gICAqL1xuICByZWFkb25seSBhY3Rpb25OYW1lPzogc3RyaW5nO1xufVxuXG5jbGFzcyBTM1NvdXJjZSBleHRlbmRzIENvZGVQaXBlbGluZVNvdXJjZSB7XG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IGJ1Y2tldDogSUJ1Y2tldCwgcHJpdmF0ZSByZWFkb25seSBvYmplY3RLZXk6IHN0cmluZywgcmVhZG9ubHkgcHJvcHM6IFMzU291cmNlT3B0aW9ucykge1xuICAgIHN1cGVyKE5vZGUub2YoYnVja2V0KS5hZGRyKTtcblxuICAgIHRoaXMuY29uZmlndXJlUHJpbWFyeU91dHB1dChuZXcgRmlsZVNldCgnU291cmNlJywgdGhpcykpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldEFjdGlvbihvdXRwdXQ6IEFydGlmYWN0LCBfYWN0aW9uTmFtZTogc3RyaW5nLCBydW5PcmRlcjogbnVtYmVyLCB2YXJpYWJsZXNOYW1lc3BhY2U/OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gbmV3IGNwX2FjdGlvbnMuUzNTb3VyY2VBY3Rpb24oe1xuICAgICAgb3V0cHV0LFxuICAgICAgLy8gQnVja2V0IG5hbWVzIGFyZSBndWFyYW50ZWVkIHRvIGNvbmZvcm0gdG8gQWN0aW9uTmFtZSByZXN0cmljdGlvbnNcbiAgICAgIGFjdGlvbk5hbWU6IHRoaXMucHJvcHMuYWN0aW9uTmFtZSA/PyB0aGlzLmJ1Y2tldC5idWNrZXROYW1lLFxuICAgICAgcnVuT3JkZXIsXG4gICAgICBidWNrZXRLZXk6IHRoaXMub2JqZWN0S2V5LFxuICAgICAgdHJpZ2dlcjogdGhpcy5wcm9wcy50cmlnZ2VyLFxuICAgICAgYnVja2V0OiB0aGlzLmJ1Y2tldCxcbiAgICAgIHZhcmlhYmxlc05hbWVzcGFjZSxcbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAqIE9wdGlvbnMgZm9yIEVDUiBzb3VyY2VzXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRUNSU291cmNlT3B0aW9ucyB7XG4gIC8qKlxuICAgKiBUaGUgaW1hZ2UgdGFnIHRoYXQgd2lsbCBiZSBjaGVja2VkIGZvciBjaGFuZ2VzLlxuICAgKlxuICAgKiBAZGVmYXVsdCBsYXRlc3RcbiAgICovXG4gIHJlYWRvbmx5IGltYWdlVGFnPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgYWN0aW9uIG5hbWUgdXNlZCBmb3IgdGhpcyBzb3VyY2UgaW4gdGhlIENvZGVQaXBlbGluZVxuICAgKlxuICAgKiBAZGVmYXVsdCAtIFRoZSByZXBvc2l0b3J5IG5hbWVcbiAgICovXG4gIHJlYWRvbmx5IGFjdGlvbk5hbWU/OiBzdHJpbmc7XG59XG5cbmNsYXNzIEVDUlNvdXJjZSBleHRlbmRzIENvZGVQaXBlbGluZVNvdXJjZSB7XG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IHJlcG9zaXRvcnk6IElSZXBvc2l0b3J5LCByZWFkb25seSBwcm9wczogRUNSU291cmNlT3B0aW9ucykge1xuICAgIHN1cGVyKE5vZGUub2YocmVwb3NpdG9yeSkuYWRkcik7XG5cbiAgICB0aGlzLmNvbmZpZ3VyZVByaW1hcnlPdXRwdXQobmV3IEZpbGVTZXQoJ1NvdXJjZScsIHRoaXMpKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRBY3Rpb24ob3V0cHV0OiBBcnRpZmFjdCwgX2FjdGlvbk5hbWU6IHN0cmluZywgcnVuT3JkZXI6IG51bWJlciwgdmFyaWFibGVzTmFtZXNwYWNlOiBzdHJpbmcpIHtcbiAgICAvLyBSZXBvc2l0b3J5TmFtZSBjYW4gY29udGFpbiAnLycgdGhhdCBpcyBub3QgYSB2YWxpZCBBY3Rpb25OYW1lIGNoYXJhY3RlciwgdXNlICdfJyBpbnN0ZWFkXG4gICAgY29uc3QgZm9ybWF0dGVkUmVwb3NpdG9yeU5hbWUgPSBGbi5qb2luKCdfJywgRm4uc3BsaXQoJy8nLCB0aGlzLnJlcG9zaXRvcnkucmVwb3NpdG9yeU5hbWUpKTtcbiAgICByZXR1cm4gbmV3IGNwX2FjdGlvbnMuRWNyU291cmNlQWN0aW9uKHtcbiAgICAgIG91dHB1dCxcbiAgICAgIGFjdGlvbk5hbWU6IHRoaXMucHJvcHMuYWN0aW9uTmFtZSA/PyBmb3JtYXR0ZWRSZXBvc2l0b3J5TmFtZSxcbiAgICAgIHJ1bk9yZGVyLFxuICAgICAgcmVwb3NpdG9yeTogdGhpcy5yZXBvc2l0b3J5LFxuICAgICAgaW1hZ2VUYWc6IHRoaXMucHJvcHMuaW1hZ2VUYWcsXG4gICAgICB2YXJpYWJsZXNOYW1lc3BhY2UsXG4gICAgfSk7XG4gIH1cbn1cblxuLyoqXG4gKiBDb25maWd1cmF0aW9uIG9wdGlvbnMgZm9yIENvZGVTdGFyIHNvdXJjZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIENvbm5lY3Rpb25Tb3VyY2VPcHRpb25zIHtcbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIENvZGVTdGFyIENvbm5lY3Rpb24gY3JlYXRlZCBpbiB0aGUgQVdTIGNvbnNvbGVcbiAgICogdGhhdCBoYXMgcGVybWlzc2lvbnMgdG8gYWNjZXNzIHRoaXMgR2l0SHViIG9yIEJpdEJ1Y2tldCByZXBvc2l0b3J5LlxuICAgKlxuICAgKiBAZXhhbXBsZSAnYXJuOmF3czpjb2Rlc3Rhci1jb25uZWN0aW9uczp1cy1lYXN0LTE6MTIzNDU2Nzg5MDEyOmNvbm5lY3Rpb24vMTIzNDU2NzgtYWJjZC0xMmFiLTM0Y2RlZjU2NzhnaCdcbiAgICogQHNlZSBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vY29kZXBpcGVsaW5lL2xhdGVzdC91c2VyZ3VpZGUvY29ubmVjdGlvbnMtY3JlYXRlLmh0bWxcbiAgICovXG4gIHJlYWRvbmx5IGNvbm5lY3Rpb25Bcm46IHN0cmluZztcblxuXG4gIC8vIGxvbmcgVVJMIGluIEBzZWVcbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIG91dHB1dCBzaG91bGQgYmUgdGhlIGNvbnRlbnRzIG9mIHRoZSByZXBvc2l0b3J5XG4gICAqICh3aGljaCBpcyB0aGUgZGVmYXVsdCksXG4gICAqIG9yIGEgbGluayB0aGF0IGFsbG93cyBDb2RlQnVpbGQgdG8gY2xvbmUgdGhlIHJlcG9zaXRvcnkgYmVmb3JlIGJ1aWxkaW5nLlxuICAgKlxuICAgKiAqKk5vdGUqKjogaWYgdGhpcyBvcHRpb24gaXMgdHJ1ZSxcbiAgICogdGhlbiBvbmx5IENvZGVCdWlsZCBhY3Rpb25zIGNhbiB1c2UgdGhlIHJlc3VsdGluZyB7QGxpbmsgb3V0cHV0fS5cbiAgICpcbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICogQHNlZSBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vY29kZXBpcGVsaW5lL2xhdGVzdC91c2VyZ3VpZGUvYWN0aW9uLXJlZmVyZW5jZS1Db2Rlc3RhckNvbm5lY3Rpb25Tb3VyY2UuaHRtbCNhY3Rpb24tcmVmZXJlbmNlLUNvZGVzdGFyQ29ubmVjdGlvblNvdXJjZS1jb25maWdcbiAgICovXG4gIHJlYWRvbmx5IGNvZGVCdWlsZENsb25lT3V0cHV0PzogYm9vbGVhbjtcblxuICAvKipcbiAgICogQ29udHJvbHMgYXV0b21hdGljYWxseSBzdGFydGluZyB5b3VyIHBpcGVsaW5lIHdoZW4gYSBuZXcgY29tbWl0XG4gICAqIGlzIG1hZGUgb24gdGhlIGNvbmZpZ3VyZWQgcmVwb3NpdG9yeSBhbmQgYnJhbmNoLiBJZiB1bnNwZWNpZmllZCxcbiAgICogdGhlIGRlZmF1bHQgdmFsdWUgaXMgdHJ1ZSwgYW5kIHRoZSBmaWVsZCBkb2VzIG5vdCBkaXNwbGF5IGJ5IGRlZmF1bHQuXG4gICAqXG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICogQHNlZSBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vY29kZXBpcGVsaW5lL2xhdGVzdC91c2VyZ3VpZGUvYWN0aW9uLXJlZmVyZW5jZS1Db2Rlc3RhckNvbm5lY3Rpb25Tb3VyY2UuaHRtbFxuICAgKi9cbiAgcmVhZG9ubHkgdHJpZ2dlck9uUHVzaD86IGJvb2xlYW47XG59XG5cbmNsYXNzIENvZGVTdGFyQ29ubmVjdGlvblNvdXJjZSBleHRlbmRzIENvZGVQaXBlbGluZVNvdXJjZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgb3duZXI6IHN0cmluZztcbiAgcHJpdmF0ZSByZWFkb25seSByZXBvOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IocmVwb1N0cmluZzogc3RyaW5nLCByZWFkb25seSBicmFuY2g6IHN0cmluZywgcmVhZG9ubHkgcHJvcHM6IENvbm5lY3Rpb25Tb3VyY2VPcHRpb25zKSB7XG4gICAgc3VwZXIocmVwb1N0cmluZyk7XG5cbiAgICBjb25zdCBwYXJ0cyA9IHJlcG9TdHJpbmcuc3BsaXQoJy8nKTtcbiAgICBpZiAoVG9rZW4uaXNVbnJlc29sdmVkKHJlcG9TdHJpbmcpIHx8IHBhcnRzLmxlbmd0aCAhPT0gMikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb2RlU3RhciByZXBvc2l0b3J5IG5hbWUgc2hvdWxkIGJlIGEgcmVzb2x2ZWQgc3RyaW5nIGxpa2UgJzxvd25lcj4vPHJlcG8+JywgZ290ICcke3JlcG9TdHJpbmd9J2ApO1xuICAgIH1cbiAgICB0aGlzLm93bmVyID0gcGFydHNbMF07XG4gICAgdGhpcy5yZXBvID0gcGFydHNbMV07XG4gICAgdGhpcy5jb25maWd1cmVQcmltYXJ5T3V0cHV0KG5ldyBGaWxlU2V0KCdTb3VyY2UnLCB0aGlzKSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0QWN0aW9uKG91dHB1dDogQXJ0aWZhY3QsIGFjdGlvbk5hbWU6IHN0cmluZywgcnVuT3JkZXI6IG51bWJlciwgdmFyaWFibGVzTmFtZXNwYWNlPzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIG5ldyBjcF9hY3Rpb25zLkNvZGVTdGFyQ29ubmVjdGlvbnNTb3VyY2VBY3Rpb24oe1xuICAgICAgb3V0cHV0LFxuICAgICAgYWN0aW9uTmFtZSxcbiAgICAgIHJ1bk9yZGVyLFxuICAgICAgY29ubmVjdGlvbkFybjogdGhpcy5wcm9wcy5jb25uZWN0aW9uQXJuLFxuICAgICAgb3duZXI6IHRoaXMub3duZXIsXG4gICAgICByZXBvOiB0aGlzLnJlcG8sXG4gICAgICBicmFuY2g6IHRoaXMuYnJhbmNoLFxuICAgICAgY29kZUJ1aWxkQ2xvbmVPdXRwdXQ6IHRoaXMucHJvcHMuY29kZUJ1aWxkQ2xvbmVPdXRwdXQsXG4gICAgICB0cmlnZ2VyT25QdXNoOiB0aGlzLnByb3BzLnRyaWdnZXJPblB1c2gsXG4gICAgICB2YXJpYWJsZXNOYW1lc3BhY2UsXG4gICAgfSk7XG4gIH1cbn1cblxuLyoqXG4gKiBDb25maWd1cmF0aW9uIG9wdGlvbnMgZm9yIGEgQ29kZUNvbW1pdCBzb3VyY2VcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBDb2RlQ29tbWl0U291cmNlT3B0aW9ucyB7XG4gIC8qKlxuICAgKiBIb3cgc2hvdWxkIENvZGVQaXBlbGluZSBkZXRlY3Qgc291cmNlIGNoYW5nZXMgZm9yIHRoaXMgQWN0aW9uLlxuICAgKlxuICAgKiBAZGVmYXVsdCBDb2RlQ29tbWl0VHJpZ2dlci5FVkVOVFNcbiAgICovXG4gIHJlYWRvbmx5IHRyaWdnZXI/OiBDb2RlQ29tbWl0VHJpZ2dlcjtcblxuICAvKipcbiAgICogUm9sZSB0byBiZSB1c2VkIGJ5IG9uIGNvbW1pdCBldmVudCBydWxlLlxuICAgKiBVc2VkIG9ubHkgd2hlbiB0cmlnZ2VyIHZhbHVlIGlzIENvZGVDb21taXRUcmlnZ2VyLkVWRU5UUy5cbiAgICpcbiAgICogQGRlZmF1bHQgYSBuZXcgcm9sZSB3aWxsIGJlIGNyZWF0ZWQuXG4gICAqL1xuICByZWFkb25seSBldmVudFJvbGU/OiBpYW0uSVJvbGU7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIG91dHB1dCBzaG91bGQgYmUgdGhlIGNvbnRlbnRzIG9mIHRoZSByZXBvc2l0b3J5XG4gICAqICh3aGljaCBpcyB0aGUgZGVmYXVsdCksXG4gICAqIG9yIGEgbGluayB0aGF0IGFsbG93cyBDb2RlQnVpbGQgdG8gY2xvbmUgdGhlIHJlcG9zaXRvcnkgYmVmb3JlIGJ1aWxkaW5nLlxuICAgKlxuICAgKiAqKk5vdGUqKjogaWYgdGhpcyBvcHRpb24gaXMgdHJ1ZSxcbiAgICogdGhlbiBvbmx5IENvZGVCdWlsZCBhY3Rpb25zIGNhbiB1c2UgdGhlIHJlc3VsdGluZyB7QGxpbmsgb3V0cHV0fS5cbiAgICpcbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICogQHNlZSBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vY29kZXBpcGVsaW5lL2xhdGVzdC91c2VyZ3VpZGUvYWN0aW9uLXJlZmVyZW5jZS1Db2RlQ29tbWl0Lmh0bWxcbiAgICovXG4gIHJlYWRvbmx5IGNvZGVCdWlsZENsb25lT3V0cHV0PzogYm9vbGVhbjtcbn1cblxuY2xhc3MgQ29kZUNvbW1pdFNvdXJjZSBleHRlbmRzIENvZGVQaXBlbGluZVNvdXJjZSB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgcmVwb3NpdG9yeTogY29kZWNvbW1pdC5JUmVwb3NpdG9yeSwgcHJpdmF0ZSByZWFkb25seSBicmFuY2g6IHN0cmluZywgcHJpdmF0ZSByZWFkb25seSBwcm9wczogQ29kZUNvbW1pdFNvdXJjZU9wdGlvbnMpIHtcbiAgICBzdXBlcihUb2tlbi5pc1VucmVzb2x2ZWQocmVwb3NpdG9yeS5yZXBvc2l0b3J5TmFtZSlcbiAgICAgID8gTm9kZS5vZihyZXBvc2l0b3J5KS5hZGRyXG4gICAgICA6IHJlcG9zaXRvcnkucmVwb3NpdG9yeU5hbWUpO1xuXG4gICAgdGhpcy5jb25maWd1cmVQcmltYXJ5T3V0cHV0KG5ldyBGaWxlU2V0KCdTb3VyY2UnLCB0aGlzKSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0QWN0aW9uKG91dHB1dDogQXJ0aWZhY3QsIF9hY3Rpb25OYW1lOiBzdHJpbmcsIHJ1bk9yZGVyOiBudW1iZXIsIHZhcmlhYmxlc05hbWVzcGFjZT86IHN0cmluZykge1xuICAgIHJldHVybiBuZXcgY3BfYWN0aW9ucy5Db2RlQ29tbWl0U291cmNlQWN0aW9uKHtcbiAgICAgIG91dHB1dCxcbiAgICAgIC8vIEd1YXJhbnRlZWQgdG8gYmUgb2theSBhcyBhY3Rpb24gbmFtZVxuICAgICAgYWN0aW9uTmFtZTogdGhpcy5yZXBvc2l0b3J5LnJlcG9zaXRvcnlOYW1lLFxuICAgICAgcnVuT3JkZXIsXG4gICAgICBicmFuY2g6IHRoaXMuYnJhbmNoLFxuICAgICAgdHJpZ2dlcjogdGhpcy5wcm9wcy50cmlnZ2VyLFxuICAgICAgcmVwb3NpdG9yeTogdGhpcy5yZXBvc2l0b3J5LFxuICAgICAgZXZlbnRSb2xlOiB0aGlzLnByb3BzLmV2ZW50Um9sZSxcbiAgICAgIGNvZGVCdWlsZENsb25lT3V0cHV0OiB0aGlzLnByb3BzLmNvZGVCdWlsZENsb25lT3V0cHV0LFxuICAgICAgdmFyaWFibGVzTmFtZXNwYWNlLFxuICAgIH0pO1xuICB9XG59XG4iXX0=